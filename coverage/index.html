<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Code Coverage for Connectors</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./dist/1.0.0/application.css" media="screen, projection, print" rel="stylesheet" type="text/css"/>
  </head>

  <body class="mdc-typography">
    <aside class="mdc-drawer mdc-drawer--dismissible mdc-drawer--open">
      <div class="mdc-drawer__header">
        <h3 class="mdc-drawer__title">Code Coverage</h3>
        <h6 class="mdc-drawer__subtitle">
          Generated using RSpec
        </h6>
      </div>
      <div class="mdc-drawer__content">
        <nav class="mdc-list">
          <a class="mdc-list-item mdc-list-item--activated" href="#" name="AllFiles" onclick="navigate(this.name)">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">view_list</i>
            <span class="mdc-list-item__text">
              All Files
              <span class="">
                (<span class="yellow">
                  80.71%
                </span>)
              </span>
            </span>
          </a>
          
        </nav>
      </div>
    </aside>
    <div class="mdc-drawer-app-content">
      <header class="mdc-top-app-bar mdc-top-app-bar--fixed app-bar" id="app-bar">
        <div class="mdc-top-app-bar__row">
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
            <a href="#" class="demo-menu material-icons mdc-top-app-bar__navigation-icon">menu</a>
            <span class="mdc-top-app-bar__title">
              Connectors
            </span>
          </section>
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end">
            Generated&nbsp;
            <abbr class="timeago" datetime="2022-03-08 13:08:45 +0100">
              2022-03-08 13:08:45 +0100
            </abbr>
          </section>
        </div>
      </header>
      <main class="main-content" id="main-content">
        <div class="mdc-top-app-bar--fixed-adjust"></div>
        <div class="tab-groups" name="AllFiles" style="display: '';">
  <div class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet">
        <div class="mdc-card card-tile">
          <p class="card-title"># of Files</p>
          <h4 class="card-data mdc-typography--headline4">
            16
          </h4>
        </div>
      </div>
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet">
        <div class="mdc-card card-tile">
          <p class="card-title">Relevent Lines</p>
          <h4 class="card-data mdc-typography--headline4">
            757
          </h4>
        </div>
      </div>
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet">
        <div class="mdc-card card-tile">
          <p class="card-title">Lines Covered</p>
          <h4 class="card-data mdc-typography--headline4 green">
            611
          </h4>
        </div>
      </div>
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet">
        <div class="mdc-card card-tile">
          <p class="card-title">Lines Missed</p>
          <h4 class="card-data mdc-typography--headline4 red">
            146
          </h4>
        </div>
      </div>
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet">
        <div class="mdc-card card-tile">
          <p class="card-title">Covered</p>
          <h4 class="card-data mdc-typography--headline4 yellow">
              80.71%
          </h4>
        </div>
      </div>
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet">
        <div class="mdc-card card-tile">
          <p class="card-title">Hits/Line</p>
          <h4 class="card-data mdc-typography--headline4 green">
              16.65
          </h4>
        </div>
      </div>
    </div>
    
  </div>

  <div class="text-field-container search-box-outline">
    <div class="mdc-text-field text-field mdc-text-field-outlined-shaped mdc-text-field--outlined mdc-text-field--with-leading-icon">
      <i class="material-icons mdc-text-field__icon">search</i>
      <input type="search" class="mdc-text-field__input search-box" onkeyup="searchTable(this.id)" onsearch="searchTable(this.id)" id="AllFiles">
      <div class="mdc-notched-outline">
        <div class="mdc-notched-outline__leading"></div>
        <div class="mdc-notched-outline__notch">
          <label for="tf-outlined" class="mdc-floating-label">Search</label>
        </div>
        <div class="mdc-notched-outline__trailing"></div>
      </div>
    </div>
    <div class="mdc-text-field-helper-line">
      <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg">You can search based on File column.</div>
    </div>
  </div>

  <br/>

  <div class="mdc-data-table">
    <table class="mdc-data-table__table" id="AllFiles-table">
        <thead>
          <tr class="mdc-data-table__header-row">
            <th class="mdc-data-table__header-cell width-320" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              File
            </th>
            <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric width-75 text-center" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              % Covered
            </th>
            <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric width-60 text-center" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              Lines
            </th>
            <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric width-75 text-center" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              Relevant Lines
            </th>
            <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric width-75 text-center" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              Lines Covered
            </th>
            <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric width-75 text-center" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              Lines Missed
            </th>
            <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric width-75 text-center" role="columnheader" scope="col">
              <i class="material-icons hide">arrow_upward</i>
              <i class="material-icons hide">arrow_downward</i>
              Avg Hits/Line
            </th>
            
          </tr>
        </thead>
        <tbody class="mdc-data-table__content">
          
            <tr class="mdc-data-table__row clickable" name="65d93697badef20d6cf2fe5ee9815ceca3f864d8"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/app/app.rb" data-sort-val="lib/app/app.rb">
                <div class="overflow">
                  lib/app/app.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center yellow" data-sort-val="84.85">
                84.85%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="129">
                129
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="66">
                66
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="56">
                56
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="10">
                10
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1.696969696969697">
                1.7
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="daa2ad10c46dac52f67e20bac4405aa060851506"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_app/config.rb" data-sort-val="lib/connectors_app/config.rb">
                <div class="overflow">
                  lib/connectors_app/config.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="100.0">
                100.00%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="15">
                15
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="4">
                4
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="4">
                4
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="0">
                0
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1.0">
                1.0
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="34442cbeb12294ad40c0ba7cf67bb09e3ba26572"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_app/errors.rb" data-sort-val="lib/connectors_app/errors.rb">
                <div class="overflow">
                  lib/connectors_app/errors.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="100.0">
                100.00%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="12">
                12
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="4">
                4
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="4">
                4
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="0">
                0
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1.0">
                1.0
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="07a4e85c10abcd694ef750db9c1b407de1ce66ae"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/base/adapter.rb" data-sort-val="lib/connectors_sdk/base/adapter.rb">
                <div class="overflow">
                  lib/connectors_sdk/base/adapter.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center yellow" data-sort-val="87.1">
                87.10%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="117">
                117
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="62">
                62
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="54">
                54
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="8">
                8
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="20.274193548387096">
                20.27
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="dcdded555ae0cbb170804f7077cc5e98eab26ddd"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/base/config.rb" data-sort-val="lib/connectors_sdk/base/config.rb">
                <div class="overflow">
                  lib/connectors_sdk/base/config.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="100.0">
                100.00%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="23">
                23
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="8">
                8
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="8">
                8
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="0">
                0
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="4.25">
                4.25
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="564250c5c7f5eeab1966024de37034f0c93a776b"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/base/custom_client.rb" data-sort-val="lib/connectors_sdk/base/custom_client.rb">
                <div class="overflow">
                  lib/connectors_sdk/base/custom_client.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center red" data-sort-val="74.55">
                74.55%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="112">
                112
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="55">
                55
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="41">
                41
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="14">
                14
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="17.763636363636362">
                17.76
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="3b4129fa8f7ff61b6b53822ad9b611d5f65435e9"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/base/extractor.rb" data-sort-val="lib/connectors_sdk/base/extractor.rb">
                <div class="overflow">
                  lib/connectors_sdk/base/extractor.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center red" data-sort-val="75.76">
                75.76%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="255">
                255
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="132">
                132
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="100">
                100
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="32">
                32
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="14.159090909090908">
                14.16
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="6a5c609b2279112596ede7c490bf505b6cc98c21"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/office365/adapter.rb" data-sort-val="lib/connectors_sdk/office365/adapter.rb">
                <div class="overflow">
                  lib/connectors_sdk/office365/adapter.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center yellow" data-sort-val="90.0">
                90.00%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="153">
                153
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="60">
                60
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="54">
                54
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="6">
                6
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="33.7">
                33.7
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="602714a05e4a3edbfc0b9c29b84bd7fdce1adf8f"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/office365/config.rb" data-sort-val="lib/connectors_sdk/office365/config.rb">
                <div class="overflow">
                  lib/connectors_sdk/office365/config.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="100.0">
                100.00%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="36">
                36
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="14">
                14
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="14">
                14
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="0">
                0
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="5.071428571428571">
                5.07
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="e2d6f56d4c70b61deade7813a644c654be831169"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/office365/custom_client.rb" data-sort-val="lib/connectors_sdk/office365/custom_client.rb">
                <div class="overflow">
                  lib/connectors_sdk/office365/custom_client.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center red" data-sort-val="76.22">
                76.22%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="295">
                295
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="143">
                143
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="109">
                109
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="34">
                34
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="24.39160839160839">
                24.39
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="14deee6b806867eac2fe5b26484adc98bc72f301"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/office365/extractor.rb" data-sort-val="lib/connectors_sdk/office365/extractor.rb">
                <div class="overflow">
                  lib/connectors_sdk/office365/extractor.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center red" data-sort-val="63.46">
                63.46%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="202">
                202
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="104">
                104
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="66">
                66
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="38">
                38
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="17.98076923076923">
                17.98
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="032f628bf402538bf91bb00770626cf5e0be81cf"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/share_point/adapter.rb" data-sort-val="lib/connectors_sdk/share_point/adapter.rb">
                <div class="overflow">
                  lib/connectors_sdk/share_point/adapter.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="100.0">
                100.00%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="47">
                47
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="20">
                20
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="20">
                20
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="0">
                0
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="11.9">
                11.9
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="4a5323b4cba55ac7c5738d0bbf272404524c5b4e"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/share_point/authorization.rb" data-sort-val="lib/connectors_sdk/share_point/authorization.rb">
                <div class="overflow">
                  lib/connectors_sdk/share_point/authorization.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="97.62">
                97.62%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="88">
                88
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="42">
                42
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="41">
                41
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1">
                1
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="3.8333333333333335">
                3.83
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="7d3baf96475a38ac46fcd9c1fcea2a7845f272a3"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/share_point/extractor.rb" data-sort-val="lib/connectors_sdk/share_point/extractor.rb">
                <div class="overflow">
                  lib/connectors_sdk/share_point/extractor.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="91.67">
                91.67%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="31">
                31
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="12">
                12
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="11">
                11
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1">
                1
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="10.333333333333334">
                10.33
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="b63d277b678ad5b1be38257d45e16b134de13876"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/connectors_sdk/share_point/http_call_wrapper.rb" data-sort-val="lib/connectors_sdk/share_point/http_call_wrapper.rb">
                <div class="overflow">
                  lib/connectors_sdk/share_point/http_call_wrapper.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="94.44">
                94.44%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="45">
                45
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="18">
                18
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="17">
                17
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1">
                1
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="12.055555555555555">
                12.06
              </td>
              
            </tr>
          
            <tr class="mdc-data-table__row clickable" name="1d143f969815d51a0025e2390a4f48fd413f511e"
                onclick="openModal(this.attributes.name.value)">
              <td title="lib/stubs/connectors/stats.rb" data-sort-val="lib/stubs/connectors/stats.rb">
                <div class="overflow">
                  lib/stubs/connectors/stats.rb
                </div>
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center green" data-sort-val="92.31">
                92.31%
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="35">
                35
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="13">
                13
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="12">
                12
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="1">
                1
              </td>
              <td class="mdc-data-table__cell mdc-data-table__cell--numeric text-center" data-sort-val="12.076923076923077">
                12.08
              </td>
              
            </tr>
          
        </tbody>
    </table>
  </div>
</div>


        
        <div class="bottom-spacer"></div>
        <section class="footer">
          <div>
            Generated by
            <a href="https://github.com/colszowka/simplecov" target="_blank">Simplecov</a>
            v0.21.2
            and
            <a href="https://github.com/chiefpansancolt/simplecov-material" target="_blank">Simplecov Material</a>
            v1.0.0
            using RSpec
          </div>
        </section>
      </main>
    </div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="65d93697badef20d6cf2fe5ee9815ceca3f864d8" id="65d93697badef20d6cf2fe5ee9815ceca3f864d8">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/app/app.rb
        <span class="parenthese">
          <span class="yellow">
              84.85%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;faraday&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;hashie&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;json&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="11">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;sinatra&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;sinatra/config_file&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="14">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/share_point/http_call_wrapper&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/share_point/authorization&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_app/errors&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_shared&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="19">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_app/config&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby"># Sinatra app</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="22">
                <span class="hits">1</span>
                

                
                <code class="ruby">class ConnectorsWebApp &lt; Sinatra::Base</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="23">
                <span class="hits">1</span>
                

                
                <code class="ruby">  register Sinatra::ConfigFile</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="24">
                <span class="hits">1</span>
                

                
                <code class="ruby">  config_file ConnectorsApp::CONFIG_FILE</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="26">
                <span class="hits">1</span>
                

                
                <code class="ruby">  configure do</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="27">
                <span class="hits">1</span>
                

                
                <code class="ruby">    set :raise_errors, settings.http[&#39;raise_errors&#39;]</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="28">
                <span class="hits">1</span>
                

                
                <code class="ruby">    set :show_exceptions, settings.http[&#39;show_exceptions&#39;]</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">    set :port, settings.http[&#39;port&#39;]</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="30">
                <span class="hits">1</span>
                

                
                <code class="ruby">    set :api_key, settings.http[&#39;api_key&#39;]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="32">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="33">
                <span class="hits">1</span>
                

                
                <code class="ruby">  before do</code>
              </li>
            
              <li class="covered" data-hits="11"
                  data-linenumber="34">
                <span class="hits">11</span>
                

                
                <code class="ruby">    raise StandardError.new &#39;You need to set an API key in the config file&#39; if settings.environment != :test &amp;&amp; settings.api_key == &#39;secret&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="11"
                  data-linenumber="36">
                <span class="hits">11</span>
                

                
                <code class="ruby">    auth = Rack::Auth::Basic::Request.new(request.env)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="37">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="38">
                
                

                
                <code class="ruby">    # Check that the key matches</code>
              </li>
            
              <li class="covered" data-hits="11"
                  data-linenumber="39">
                <span class="hits">11</span>
                

                
                <code class="ruby">    return if auth.provided? &amp;&amp; auth.basic? &amp;&amp; auth.credentials &amp;&amp; auth.credentials[1] == settings.api_key</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="40">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="41">
                
                

                
                <code class="ruby">    # We only support Basic for now</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="42">
                <span class="hits">4</span>
                

                
                <code class="ruby">    if auth.provided? &amp;&amp; auth.scheme != &#39;basic&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="43">
                <span class="hits">1</span>
                

                
                <code class="ruby">      code = ConnectorsApp::Errors::UNSUPPORTED_AUTH_SCHEME</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="44">
                <span class="hits">1</span>
                

                
                <code class="ruby">      message = &#39;Unsupported authorization scheme&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="45">
                
                

                
                <code class="ruby">    else</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="46">
                <span class="hits">3</span>
                

                
                <code class="ruby">      code = ConnectorsApp::Errors::INVALID_API_KEY</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="47">
                <span class="hits">3</span>
                

                
                <code class="ruby">      message = &#39;Invalid API key&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="48">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="49">
                <span class="hits">4</span>
                

                
                <code class="ruby">    response = { errors: [{ message: message, code: code }] }.to_json</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="50">
                <span class="hits">4</span>
                

                
                <code class="ruby">    halt(401, { &#39;Content-Type&#39; =&gt; &#39;application/json&#39; }, response)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="51">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="52">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="53">
                <span class="hits">1</span>
                

                
                <code class="ruby">  get &#39;/&#39; do</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="54">
                <span class="hits">2</span>
                

                
                <code class="ruby">    content_type :json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="55">
                
                

                
                <code class="ruby">    {</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="56">
                <span class="hits">2</span>
                

                
                <code class="ruby">      version: settings.version,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="57">
                
                

                
                <code class="ruby">      repository: settings.repository,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="58">
                
                

                
                <code class="ruby">      revision: settings.revision</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="59">
                
                

                
                <code class="ruby">    }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="60">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="61">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="62">
                <span class="hits">1</span>
                

                
                <code class="ruby">  get &#39;/health&#39; do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="63">
                
                

                
                <code class="ruby">    content_type :json</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="64">
                
                

                
                <code class="ruby">    { healthy: &#39;yes&#39; }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="65">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="66">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="67">
                <span class="hits">1</span>
                

                
                <code class="ruby">  get &#39;/status&#39; do</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="68">
                <span class="hits">1</span>
                

                
                <code class="ruby">    content_type :json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="69">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="70">
                
                

                
                <code class="ruby">    # TODO: wait for other refactorings to replace this code in the right spot</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="71">
                <span class="hits">1</span>
                

                
                <code class="ruby">    response = Faraday.get(&#39;https://graph.microsoft.com/v1.0/me&#39;)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="72">
                <span class="hits">1</span>
                

                
                <code class="ruby">    response_json = Hashie::Mash.new(JSON.parse(response.body))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="73">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="74">
                <span class="hits">1</span>
                

                
                <code class="ruby">    status = response_json.error? ? &#39;FAILURE&#39; : &#39;OK&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="75">
                <span class="hits">1</span>
                

                
                <code class="ruby">    message = response_json.error? ? response_json.error.message : &#39;Connected to SharePoint&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="76">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby">    {</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="78">
                <span class="hits">1</span>
                

                
                <code class="ruby">      extractor: {</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="79">
                
                

                
                <code class="ruby">        name: &#39;SharePoint&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="80">
                
                

                
                <code class="ruby">      },</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="81">
                
                

                
                <code class="ruby">      contentProvider: {</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="82">
                
                

                
                <code class="ruby">        status: status,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="83">
                
                

                
                <code class="ruby">        statusCode: response.status,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby">        message: message</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="85">
                
                

                
                <code class="ruby">      }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="86">
                
                

                
                <code class="ruby">    }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="87">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="88">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="89">
                <span class="hits">1</span>
                

                
                <code class="ruby">  post &#39;/documents&#39; do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="90">
                
                

                
                <code class="ruby">    content_type :json</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="91">
                
                

                
                <code class="ruby">    params = JSON.parse(request.body.read)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="92">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="93">
                
                

                
                <code class="ruby">    connector = ConnectorsSdk::SharePoint::HttpCallWrapper.new(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="94">
                
                

                
                <code class="ruby">      params</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="95">
                
                

                
                <code class="ruby">    )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="96">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="97">
                
                

                
                <code class="ruby">    return { results: connector.document_batch, cursor: nil }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="98">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="99">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="100">
                <span class="hits">1</span>
                

                
                <code class="ruby">  post &#39;/download&#39; do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="101">
                
                

                
                <code class="ruby">    file = File.join(__dir__, &#39;cat.jpg&#39;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="102">
                
                

                
                <code class="ruby">    send_file(file, type: &#39;image/jpeg&#39;, disposition: &#39;inline&#39;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="103">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="104">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="105">
                
                

                
                <code class="ruby">  # XXX remove `oauth2` from the name</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="106">
                <span class="hits">1</span>
                

                
                <code class="ruby">  post &#39;/oauth2/init&#39; do</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="107">
                <span class="hits">3</span>
                

                
                <code class="ruby">    content_type :json</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="108">
                <span class="hits">3</span>
                

                
                <code class="ruby">    body = JSON.parse(request.body.read, symbolize_names: true)</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="109">
                <span class="hits">3</span>
                

                
                <code class="ruby">    logger.info &quot;Received client ID: #{body[:client_id]} and client secret: #{body[:client_secret]}&quot;</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="110">
                <span class="hits">3</span>
                

                
                <code class="ruby">    logger.info &quot;Received redirect URL: #{body[:redirect_uri]}&quot;</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="111">
                <span class="hits">3</span>
                

                
                <code class="ruby">    authorization_uri = ConnectorsSdk::SharePoint::Authorization.authorization_uri(body)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="112">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="113">
                <span class="hits">2</span>
                

                
                <code class="ruby">    { oauth2redirect: authorization_uri.to_s }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="114">
                
                

                
                <code class="ruby">  rescue StandardError =&gt; e</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="115">
                <span class="hits">1</span>
                

                
                <code class="ruby">    status e.is_a?(ConnectorsShared::ClientError) ? 400 : 500</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="116">
                <span class="hits">1</span>
                

                
                <code class="ruby">    { errors: [{ message: e.message }] }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="117">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="118">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="119">
                
                

                
                <code class="ruby">  # XXX remove `oauth2` from the name</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="120">
                <span class="hits">1</span>
                

                
                <code class="ruby">  post &#39;/oauth2/exchange&#39; do</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="121">
                <span class="hits">1</span>
                

                
                <code class="ruby">    content_type :json</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="122">
                <span class="hits">1</span>
                

                
                <code class="ruby">    params = JSON.parse(request.body.read, symbolize_names: true)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="123">
                <span class="hits">1</span>
                

                
                <code class="ruby">    logger.info &quot;Received payload: #{params}&quot;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="124">
                <span class="hits">1</span>
                

                
                <code class="ruby">    ConnectorsSdk::SharePoint::Authorization.access_token(params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="125">
                
                

                
                <code class="ruby">  rescue StandardError =&gt; e</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="126">
                
                

                
                <code class="ruby">    status e.is_a?(ConnectorsShared::ClientError) ? 400 : 500</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="127">
                
                

                
                <code class="ruby">    { errors: [{ message: e.message }] }.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="128">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="129">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>66</b> Relevant Lines
          |
          <span class="green"><b>
            56
          </b></span> Lines Covered
          |
          <span class="red"><b>
            10
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="daa2ad10c46dac52f67e20bac4405aa060851506" id="daa2ad10c46dac52f67e20bac4405aa060851506">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_app/config.rb
        <span class="parenthese">
          <span class="green">
              100.0%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="6">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;yaml&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsApp</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="9">
                
                

                
                <code class="ruby">  # We look for places in this order:</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="10">
                
                

                
                <code class="ruby">  # - CONNECTORS_CONFIG environement variable</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="11">
                
                

                
                <code class="ruby">  # - here/../config/connectors.yml</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">  CONFIG_FILE = ENV[&#39;CONNECTORS_CONFIG&#39;] || File.join(__dir__, &#39;../..&#39;, &#39;config&#39;, &#39;connectors.yml&#39;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="13">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">  Config = YAML.load_file(CONFIG_FILE)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>4</b> Relevant Lines
          |
          <span class="green"><b>
            4
          </b></span> Lines Covered
          |
          <span class="red"><b>
            0
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="34442cbeb12294ad40c0ba7cf67bb09e3ba26572" id="34442cbeb12294ad40c0ba7cf67bb09e3ba26572">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_app/errors.rb
        <span class="parenthese">
          <span class="green">
              100.0%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="7">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsApp</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Errors</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">    INVALID_API_KEY = &#39;INVALID_API_KEY&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">    UNSUPPORTED_AUTH_SCHEME = &#39;UNSUPPORTED_AUTH_SCHEME&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="11">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="12">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>4</b> Relevant Lines
          |
          <span class="green"><b>
            4
          </b></span> Lines Covered
          |
          <span class="red"><b>
            0
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="07a4e85c10abcd694ef750db9c1b407de1ce66ae" id="07a4e85c10abcd694ef750db9c1b407de1ce66ae">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/base/adapter.rb
        <span class="parenthese">
          <span class="yellow">
              87.1%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="7">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/array/wrap&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/numeric/time&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/object/deep_dup&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_shared&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;date&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/all&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;mime-types&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="14">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Base</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Adapter</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.fields_to_preserve</code>
              </li>
            
              <li class="covered" data-hits="115"
                  data-linenumber="19">
                <span class="hits">115</span>
                

                
                <code class="ruby">        @fields_to_preserve ||= [&#39;body&#39;]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby">          .concat(ConnectorsShared::Constants::THUMBNAIL_FIELDS)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby">          .concat(ConnectorsShared::Constants::SUBEXTRACTOR_RESERVED_FIELDS)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby">          .map(&amp;:freeze)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="23">
                
                

                
                <code class="ruby">          .freeze</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="26">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.generate_id_helpers(method_prefix, id_prefix)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="27">
                <span class="hits">6</span>
                

                
                <code class="ruby">        define_singleton_method(&quot;#{method_prefix}_id_to_fp_id&quot;) do |id|</code>
              </li>
            
              <li class="covered" data-hits="113"
                  data-linenumber="28">
                <span class="hits">113</span>
                

                
                <code class="ruby">          &quot;#{id_prefix}_#{id}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="29">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="30">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="31">
                <span class="hits">6</span>
                

                
                <code class="ruby">        define_singleton_method(&quot;fp_id_is_#{method_prefix}_id?&quot;) do |fp_id|</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="32">
                <span class="hits">1</span>
                

                
                <code class="ruby">          regex_match = /#{id_prefix}_(.+)$/.match(fp_id)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="33">
                <span class="hits">1</span>
                

                
                <code class="ruby">          regex_match.present? &amp;&amp; regex_match.size == 2</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="34">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="36">
                <span class="hits">6</span>
                

                
                <code class="ruby">        define_singleton_method(&quot;fp_id_to_#{method_prefix}_id&quot;) do |fp_id|</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="37">
                <span class="hits">3</span>
                

                
                <code class="ruby">          regex_match = /#{id_prefix}_(.+)$/.match(fp_id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="38">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="39">
                <span class="hits">3</span>
                

                
                <code class="ruby">          raise ArgumentError, &quot;Invalid id #{fp_id} for source with method prefix #{method_prefix}.&quot; if regex_match.nil? || regex_match.length != 2</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="40">
                <span class="hits">1</span>
                

                
                <code class="ruby">          regex_match[1]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="41">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="44">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.mime_type_for_file(file_name)</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="45">
                <span class="hits">7</span>
                

                
                <code class="ruby">        ruby_detected_type = MIME::Types.type_for(file_name)</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="46">
                <span class="hits">7</span>
                

                
                <code class="ruby">        return ruby_detected_type.first.simplified if ruby_detected_type.present?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="47">
                
                

                
                <code class="ruby">        extension = extension_for_file(file_name)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="48">
                
                

                
                <code class="ruby">        ConnectorsShared::ExtensionMappingUtil.get_mime_types(extension)&amp;.first</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="49">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="50">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="51">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.extension_for_file(file_name)</code>
              </li>
            
              <li class="covered" data-hits="9"
                  data-linenumber="52">
                <span class="hits">9</span>
                

                
                <code class="ruby">        File.extname(file_name.downcase).delete_prefix!(&#39;.&#39;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="53">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="54">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="55">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.strip_file_extension(file_name)</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="56">
                <span class="hits">7</span>
                

                
                <code class="ruby">        File.basename(file_name, File.extname(file_name))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="57">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="58">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="59">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.normalize_enum(enum)</code>
              </li>
            
              <li class="covered" data-hits="116"
                  data-linenumber="60">
                <span class="hits">116</span>
                

                
                <code class="ruby">        enum&amp;.to_s&amp;.downcase</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="61">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="62">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="63">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.normalize_date(date)</code>
              </li>
            
              <li class="covered" data-hits="230"
                  data-linenumber="64">
                <span class="hits">230</span>
                

                
                <code class="ruby">        return nil if date.blank?</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="65">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="20"
                  data-linenumber="66">
                <span class="hits">20</span>
                

                
                <code class="ruby">        case date</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="67">
                
                

                
                <code class="ruby">        when Date, Time, DateTime, ActiveSupport::TimeWithZone</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="68">
                
                

                
                <code class="ruby">          date.to_datetime.rfc3339</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="69">
                
                

                
                <code class="ruby">        else</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="70">
                
                

                
                <code class="ruby">          begin</code>
              </li>
            
              <li class="covered" data-hits="20"
                  data-linenumber="71">
                <span class="hits">20</span>
                

                
                <code class="ruby">            Time.zone.parse(date).to_datetime.rfc3339</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="72">
                
                

                
                <code class="ruby">          rescue ArgumentError, TypeError =&gt; e</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="73">
                
                

                
                <code class="ruby">            ConnectorsShared::ExceptionTracking.capture_exception(e)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="74">
                
                

                
                <code class="ruby">            nil</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="75">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="76">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="78">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="79">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.normalize_path(path)</code>
              </li>
            
              <li class="covered" data-hits="225"
                  data-linenumber="80">
                <span class="hits">225</span>
                

                
                <code class="ruby">        return nil if path.blank?</code>
              </li>
            
              <li class="covered" data-hits="224"
                  data-linenumber="81">
                <span class="hits">224</span>
                

                
                <code class="ruby">        return path if path.start_with?(&#39;/&#39;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="82">
                
                

                
                <code class="ruby">        &quot;/#{path}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="83">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="85">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.url_to_path(url)</code>
              </li>
            
              <li class="covered" data-hits="15"
                  data-linenumber="86">
                <span class="hits">15</span>
                

                
                <code class="ruby">        return nil if url.blank?</code>
              </li>
            
              <li class="covered" data-hits="11"
                  data-linenumber="87">
                <span class="hits">11</span>
                

                
                <code class="ruby">        uri = URI(url)</code>
              </li>
            
              <li class="covered" data-hits="11"
                  data-linenumber="88">
                <span class="hits">11</span>
                

                
                <code class="ruby">        return nil if uri.scheme.blank?</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="89">
                <span class="hits">7</span>
                

                
                <code class="ruby">        normalize_path(uri.path)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="90">
                
                

                
                <code class="ruby">      rescue URI::InvalidURIError, ArgumentError</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="91">
                
                

                
                <code class="ruby">        nil</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="92">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="93">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="94">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.swiftype_document_from_configured_object_base(object_type:, object:, fields:)</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="95">
                <span class="hits">4</span>
                

                
                <code class="ruby">        object_as_json = object.as_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="96">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="97">
                
                

                
                <code class="ruby">        adapted_object = {</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="98">
                <span class="hits">4</span>
                

                
                <code class="ruby">          :type =&gt; normalize_enum(object_type)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="99">
                
                

                
                <code class="ruby">        }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="100">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="101">
                <span class="hits">4</span>
                

                
                <code class="ruby">        fields.each do |field_data|</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="102">
                <span class="hits">12</span>
                

                
                <code class="ruby">          remote_field_name = field_data.fetch(:remote)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="103">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="104">
                <span class="hits">12</span>
                

                
                <code class="ruby">          value = object_as_json[remote_field_name]</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="105">
                <span class="hits">12</span>
                

                
                <code class="ruby">          value = object_as_json.dig(*remote_field_name.split(&#39;.&#39;)) if value.blank?</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="106">
                <span class="hits">12</span>
                

                
                <code class="ruby">          next if value.nil?</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="107">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="8"
                  data-linenumber="108">
                <span class="hits">8</span>
                

                
                <code class="ruby">          adapted_object[field_data.fetch(:target)] = value</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="109">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="110">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="111">
                <span class="hits">4</span>
                

                
                <code class="ruby">        adapted_object.symbolize_keys</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="112">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="113">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="114">
                <span class="hits">1</span>
                

                
                <code class="ruby">      delegate :normalize_enum, :normalize_date, :normalize_path, :to =&gt; :class</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="115">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="116">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="117">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>62</b> Relevant Lines
          |
          <span class="green"><b>
            54
          </b></span> Lines Covered
          |
          <span class="red"><b>
            8
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="dcdded555ae0cbb170804f7077cc5e98eab26ddd" id="dcdded555ae0cbb170804f7077cc5e98eab26ddd">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/base/config.rb
        <span class="parenthese">
          <span class="green">
              100.0%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="7">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Base</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Config</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_reader :cursors</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="11">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def initialize(cursors:)</code>
              </li>
            
              <li class="covered" data-hits="27"
                  data-linenumber="13">
                <span class="hits">27</span>
                

                
                <code class="ruby">        @cursors = cursors || {}</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="14">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def to_h</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="17">
                
                

                
                <code class="ruby">        {</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">          :cursors =&gt; cursors</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="19">
                
                

                
                <code class="ruby">        }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="23">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>8</b> Relevant Lines
          |
          <span class="green"><b>
            8
          </b></span> Lines Covered
          |
          <span class="red"><b>
            0
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="564250c5c7f5eeab1966024de37034f0c93a776b" id="564250c5c7f5eeab1966024de37034f0c93a776b">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/base/custom_client.rb
        <span class="parenthese">
          <span class="red">
              74.55%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="7">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;faraday&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;httpclient&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/array/wrap&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/numeric/time&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/object/deep_dup&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_shared&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;date&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/all&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Base</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class CustomClient</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="19">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_reader :base_url, :middleware, :ensure_fresh_auth</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="21">
                <span class="hits">1</span>
                

                
                <code class="ruby">      MAX_RETRIES = 5</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="23">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def initialize(base_url: nil, ensure_fresh_auth: nil)</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="24">
                <span class="hits">32</span>
                

                
                <code class="ruby">        @base_url = base_url</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="25">
                <span class="hits">32</span>
                

                
                <code class="ruby">        @ensure_fresh_auth = ensure_fresh_auth</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="26">
                <span class="hits">32</span>
                

                
                <code class="ruby">        middleware!</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="28">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def middleware!</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="30">
                <span class="hits">32</span>
                

                
                <code class="ruby">        @middleware = Array.wrap(additional_middleware)</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="31">
                <span class="hits">32</span>
                

                
                <code class="ruby">        @middleware += Array.wrap(default_middleware)</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="32">
                <span class="hits">32</span>
                

                
                <code class="ruby">        @middleware.compact!</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="33">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="34">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="35">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def additional_middleware</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="36">
                <span class="hits">32</span>
                

                
                <code class="ruby">        [] # define as needed in subclass</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="37">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="38">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="39">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def default_middleware</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="40">
                <span class="hits">32</span>
                

                
                <code class="ruby">        [[Faraday::Request::Retry, retry_config]]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="41">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="43">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def retry_config</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="44">
                
                

                
                <code class="ruby">        {</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="45">
                <span class="hits">32</span>
                

                
                <code class="ruby">          :retry_statuses =&gt; [429],</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="46">
                
                

                
                <code class="ruby">          :backoff_factor =&gt; 2,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="47">
                
                

                
                <code class="ruby">          :max =&gt; MAX_RETRIES,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="48">
                
                

                
                <code class="ruby">          :interval =&gt; 0.05</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="49">
                
                

                
                <code class="ruby">        }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="50">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="51">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="52">
                <span class="hits">1</span>
                

                
                <code class="ruby">      [</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="53">
                
                

                
                <code class="ruby">        :delete,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="54">
                
                

                
                <code class="ruby">        :get,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="55">
                
                

                
                <code class="ruby">        :head,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="56">
                
                

                
                <code class="ruby">        :options,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="57">
                
                

                
                <code class="ruby">        :patch,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="58">
                
                

                
                <code class="ruby">        :post,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="59">
                
                

                
                <code class="ruby">        :put,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="60">
                
                

                
                <code class="ruby">      ].each do |http_verb|</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="61">
                <span class="hits">7</span>
                

                
                <code class="ruby">        define_method http_verb do |*args, &amp;block|</code>
              </li>
            
              <li class="covered" data-hits="187"
                  data-linenumber="62">
                <span class="hits">187</span>
                

                
                <code class="ruby">          ensure_fresh_auth.call(self) if ensure_fresh_auth.present?</code>
              </li>
            
              <li class="covered" data-hits="187"
                  data-linenumber="63">
                <span class="hits">187</span>
                

                
                <code class="ruby">          http_client.public_send(http_verb, *args, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="64">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="65">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="66">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="67">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def http_client!</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="68">
                
                

                
                <code class="ruby">        @http_client = nil</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="69">
                
                

                
                <code class="ruby">        http_client</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="70">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="71">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="72">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def http_client</code>
              </li>
            
              <li class="covered" data-hits="187"
                  data-linenumber="73">
                <span class="hits">187</span>
                

                
                <code class="ruby">        @http_client ||= Faraday.new(base_url) do |faraday|</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="74">
                <span class="hits">32</span>
                

                
                <code class="ruby">          middleware.each do |middleware_config|</code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="75">
                <span class="hits">32</span>
                

                
                <code class="ruby">            faraday.use(*middleware_config)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="76">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="32"
                  data-linenumber="78">
                <span class="hits">32</span>
                

                
                <code class="ruby">          faraday.adapter(:httpclient)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="79">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="80">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="81">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="82">
                <span class="hits">1</span>
                

                
                <code class="ruby">      private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="83">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby">      # https://github.com/lostisland/faraday/blob/b09c6db31591dd1a58fffcc0979b0c7d96b5388b/lib/faraday/connection.rb#L171</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="85">
                <span class="hits">1</span>
                

                
                <code class="ruby">      METHODS_WITH_BODY = [:post, :put, :patch].freeze</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="86">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="87">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def send_body?(method)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="88">
                
                

                
                <code class="ruby">        METHODS_WITH_BODY.include?(method.to_sym)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="89">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="90">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="91">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def request_with_throttling(method, url, options = {})</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="92">
                
                

                
                <code class="ruby">        response =</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="93">
                
                

                
                <code class="ruby">          if send_body?(method)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="94">
                
                

                
                <code class="ruby">            public_send(method, url, options[:body], options[:headers])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="95">
                
                

                
                <code class="ruby">          else</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="96">
                
                

                
                <code class="ruby">            public_send(method, url, options[:params], options[:headers])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="97">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="98">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="99">
                
                

                
                <code class="ruby">        if response.status == 429</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="100">
                
                

                
                <code class="ruby">          retry_after = response.headers[&#39;Retry-After&#39;]</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="101">
                
                

                
                <code class="ruby">          multiplier = options.fetch(:retry_mulitplier, 1)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="102">
                
                

                
                <code class="ruby">          retry_after_secs = (retry_after.is_a?(Array) ? retry_after.first.to_i : retry_after.to_i) * multiplier</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="103">
                
                

                
                <code class="ruby">          retry_after_secs = 60 if retry_after_secs &lt;= 0</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="104">
                
                

                
                <code class="ruby">          ConnectorsShared::Logger.warn(&quot;Exceeded #{self.class} request limits. Going to sleep for #{retry_after_secs} seconds&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="105">
                
                

                
                <code class="ruby">          raise ConnectorsShared::ThrottlingError.new(:suspend_until =&gt; DateTime.now + retry_after_secs.seconds, :cursors =&gt; options[:cursors])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="106">
                
                

                
                <code class="ruby">        else</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="107">
                
                

                
                <code class="ruby">          response</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="108">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="109">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="110">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="111">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="112">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>55</b> Relevant Lines
          |
          <span class="green"><b>
            41
          </b></span> Lines Covered
          |
          <span class="red"><b>
            14
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="3b4129fa8f7ff61b6b53822ad9b611d5f65435e9" id="3b4129fa8f7ff61b6b53822ad9b611d5f65435e9">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/base/extractor.rb
        <span class="parenthese">
          <span class="red">
              75.76%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="7">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;faraday&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="8">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;httpclient&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/array/wrap&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/numeric/time&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/core_ext/object/deep_dup&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_shared&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;date&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/all&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;stubs/connectors/stats&#39; unless defined?(Rails)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="16">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Base</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="19">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Extractor</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="20">
                <span class="hits">1</span>
                

                
                <code class="ruby">      MAX_CONNECTION_ATTEMPTS = 3</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="21">
                <span class="hits">1</span>
                

                
                <code class="ruby">      DEFAULT_CURSOR_KEY = &#39;all&#39;.freeze</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="23">
                <span class="hits">1</span>
                

                
                <code class="ruby">      TRANSIENT_SERVER_ERROR_CLASSES = Set.new(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby">        [</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby">          Faraday::ConnectionFailed,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="26">
                
                

                
                <code class="ruby">          Faraday::SSLError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby">          Faraday::TimeoutError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="28">
                
                

                
                <code class="ruby">          HTTPClient::ConnectTimeoutError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="29">
                
                

                
                <code class="ruby">          Net::OpenTimeout</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="30">
                
                

                
                <code class="ruby">        ]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">      )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="32">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="33">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_reader :content_source_id, :config, :features, :original_cursors, :service_type</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="34">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_accessor :monitor, :client_proc</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="36">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def initialize(content_source_id:,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="37">
                
                

                
                <code class="ruby">                     service_type:,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="38">
                
                

                
                <code class="ruby">                     config:,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="39">
                
                

                
                <code class="ruby">                     features:,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="40">
                
                

                
                <code class="ruby">                     client_proc:,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="41">
                
                

                
                <code class="ruby">                     authorization_data_proc:,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby">                     monitor: ConnectorsShared::Monitor.new(:connector =&gt; self))</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="43">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @content_source_id = content_source_id</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="44">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @service_type = service_type</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="45">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @config = config</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="46">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @features = features</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="47">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @client_proc = client_proc</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="48">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @authorization_data_proc = authorization_data_proc</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="49">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @original_cursors = config.cursors.deep_dup</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="50">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @monitor = monitor</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="51">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="52">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="53">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def authorization_data!</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="54">
                
                

                
                <code class="ruby">        @authorization_data = nil</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="55">
                
                

                
                <code class="ruby">        authorization_data</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="56">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="57">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="58">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def authorization_data</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="59">
                
                

                
                <code class="ruby">        @authorization_data ||= @authorization_data_proc.call</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="60">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="61">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="62">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def client!</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="63">
                
                

                
                <code class="ruby">        @client = nil</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="64">
                
                

                
                <code class="ruby">        client</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="65">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="66">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="67">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def client</code>
              </li>
            
              <li class="covered" data-hits="16"
                  data-linenumber="68">
                <span class="hits">16</span>
                

                
                <code class="ruby">        @client ||= client_proc.call</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="69">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="70">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="71">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def retrieve_latest_cursors</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="72">
                
                

                
                <code class="ruby">        nil</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="73">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="74">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="75">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def with_auth_tokens_and_retry(&amp;block)</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="76">
                <span class="hits">12</span>
                

                
                <code class="ruby">        connection_attempts = 0</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="78">
                
                

                
                <code class="ruby">        begin</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="79">
                <span class="hits">18</span>
                

                
                <code class="ruby">          convert_transient_server_errors do</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="80">
                <span class="hits">18</span>
                

                
                <code class="ruby">            convert_rate_limit_errors(&amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="81">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="82">
                <span class="hits">12</span>
                

                
                <code class="ruby">        rescue ConnectorsShared::TokenRefreshFailedError =&gt; e</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="83">
                <span class="hits">1</span>
                

                
                <code class="ruby">          log_error(&#39;Could not refresh token, aborting&#39;)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="84">
                <span class="hits">1</span>
                

                
                <code class="ruby">          raise e</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="85">
                
                

                
                <code class="ruby">        rescue ConnectorsShared::PublishingFailedError =&gt; e</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="86">
                
                

                
                <code class="ruby">          log_error(&#39;Could not publish, aborting&#39;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="87">
                
                

                
                <code class="ruby">          raise e.reason</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="88">
                
                

                
                <code class="ruby">        rescue ConnectorsShared::EvictionWithNoProgressError</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="89">
                
                

                
                <code class="ruby">          log_error(&#39;Aborting job because it did not make any progress and cannot be evicted&#39;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="90">
                
                

                
                <code class="ruby">          raise</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="91">
                
                

                
                <code class="ruby">        rescue ConnectorsShared::EvictionError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="92">
                
                

                
                <code class="ruby">               ConnectorsShared::ThrottlingError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="93">
                
                

                
                <code class="ruby">               ConnectorsShared::JobDocumentLimitError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="94">
                
                

                
                <code class="ruby">               ConnectorsShared::MonitoringError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="95">
                
                

                
                <code class="ruby">               ConnectorsShared::JobInterruptedError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="96">
                
                

                
                <code class="ruby">               ConnectorsShared::SecretInvalidError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="97">
                
                

                
                <code class="ruby">               ConnectorsShared::InvalidIndexingConfigurationError =&gt; e</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="98">
                
                

                
                <code class="ruby">          # Don&#39;t retry eviction, throttling, document limit, or monitoring errors, let them bubble out</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="99">
                <span class="hits">3</span>
                

                
                <code class="ruby">          raise</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="100">
                
                

                
                <code class="ruby">        rescue StandardError =&gt; e</code>
              </li>
            
              <li class="covered" data-hits="8"
                  data-linenumber="101">
                <span class="hits">8</span>
                

                
                <code class="ruby">          ConnectorsShared::ExceptionTracking.augment_exception(e)</code>
              </li>
            
              <li class="covered" data-hits="8"
                  data-linenumber="102">
                <span class="hits">8</span>
                

                
                <code class="ruby">          connection_attempts += 1</code>
              </li>
            
              <li class="covered" data-hits="8"
                  data-linenumber="103">
                <span class="hits">8</span>
                

                
                <code class="ruby">          if connection_attempts &gt;= MAX_CONNECTION_ATTEMPTS</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="104">
                <span class="hits">2</span>
                

                
                <code class="ruby">            log_warn(&quot;Failed to connect in with_auth_tokens_and_retry Reason: #{e.class}: #{e.message} {:message_id =&gt; #{e.id}}&quot;)</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="105">
                <span class="hits">2</span>
                

                
                <code class="ruby">            log_warn(&quot;Retries: #{connection_attempts}/#{MAX_CONNECTION_ATTEMPTS}, giving up.&quot;)</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="106">
                <span class="hits">2</span>
                

                
                <code class="ruby">            ConnectorsShared::ExceptionTracking.log_exception(e)</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="107">
                <span class="hits">2</span>
                

                
                <code class="ruby">            raise e</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="108">
                
                

                
                <code class="ruby">          else</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="109">
                <span class="hits">6</span>
                

                
                <code class="ruby">            log_warn(&quot;Failed to connect in with_auth_tokens_and_retry. Reason: #{e.class}: #{e.message} {:message_id =&gt; #{e.id}}&quot;)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="110">
                <span class="hits">6</span>
                

                
                <code class="ruby">            log_warn(&quot;Retries: #{connection_attempts}/#{MAX_CONNECTION_ATTEMPTS}, trying again.&quot;)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="111">
                <span class="hits">6</span>
                

                
                <code class="ruby">            retry</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="112">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="113">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="114">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="115">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="116">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_document_changes(modified_since: nil)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="117">
                
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="118">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="119">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="120">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def document_changes(modified_since: nil, &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="121">
                <span class="hits">12</span>
                

                
                <code class="ruby">        enum = nil</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="122">
                <span class="hits">12</span>
                

                
                <code class="ruby">        Connectors::Stats.measure(&quot;extractor.#{Connectors::Stats.class_key(self.class)}.documents&quot;) do</code>
              </li>
            
              <li class="covered" data-hits="12"
                  data-linenumber="123">
                <span class="hits">12</span>
                

                
                <code class="ruby">          with_auth_tokens_and_retry do</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="124">
                <span class="hits">18</span>
                

                
                <code class="ruby">            Connectors::Stats.measure(&quot;extractor.#{Connectors::Stats.class_key(self.class)}.yield_documents&quot;) do</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="125">
                <span class="hits">18</span>
                

                
                <code class="ruby">              counter = 0</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="126">
                <span class="hits">18</span>
                

                
                <code class="ruby">              enum = Enumerator.new do |yielder|</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="127">
                <span class="hits">18</span>
                

                
                <code class="ruby">                yield_document_changes(:modified_since =&gt; modified_since) do |action, change, subextractors|</code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="128">
                <span class="hits">13</span>
                

                
                <code class="ruby">                  yielder.yield action, change, subextractors</code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="129">
                <span class="hits">13</span>
                

                
                <code class="ruby">                  counter += 1</code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="130">
                <span class="hits">13</span>
                

                
                <code class="ruby">                  log_info(&quot;Extracted #{counter} documents so far&quot;) if counter % 100 == 0</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="131">
                
                

                
                <code class="ruby">                end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="132">
                
                

                
                <code class="ruby">              end</code>
              </li>
            
              <li class="covered" data-hits="18"
                  data-linenumber="133">
                <span class="hits">18</span>
                

                
                <code class="ruby">              enum.each(&amp;block) if block_given?</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="134">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="135">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="136">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="137">
                <span class="hits">6</span>
                

                
                <code class="ruby">        enum</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="138">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="139">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="140">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_single_document_change(identifier: nil, &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="123"
                  data-linenumber="141">
                <span class="hits">123</span>
                

                
                <code class="ruby">        log_debug(&quot;Extracting single document for #{identifier}&quot;) if identifier</code>
              </li>
            
              <li class="covered" data-hits="123"
                  data-linenumber="142">
                <span class="hits">123</span>
                

                
                <code class="ruby">        convert_transient_server_errors do</code>
              </li>
            
              <li class="covered" data-hits="123"
                  data-linenumber="143">
                <span class="hits">123</span>
                

                
                <code class="ruby">          convert_rate_limit_errors(&amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="144">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="covered" data-hits="117"
                  data-linenumber="145">
                <span class="hits">117</span>
                

                
                <code class="ruby">        monitor.note_success</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="146">
                
                

                
                <code class="ruby">      rescue *fatal_exception_classes =&gt; e</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="147">
                <span class="hits">1</span>
                

                
                <code class="ruby">        ConnectorsShared::ExceptionTracking.augment_exception(e)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="148">
                <span class="hits">1</span>
                

                
                <code class="ruby">        log_error(&quot;Encountered a fall-through error during extraction#{identifying_error_message(identifier)}: #{e.class}: #{e.message} {:message_id =&gt; #{e.id}}&quot;)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="149">
                <span class="hits">1</span>
                

                
                <code class="ruby">        raise</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="150">
                
                

                
                <code class="ruby">      rescue StandardError =&gt; e</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="151">
                <span class="hits">4</span>
                

                
                <code class="ruby">        ConnectorsShared::ExceptionTracking.augment_exception(e)</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="152">
                <span class="hits">4</span>
                

                
                <code class="ruby">        log_warn(&quot;Encountered error during extraction#{identifying_error_message(identifier)}: #{e.class}: #{e.message} {:message_id =&gt; #{e.id}}&quot;)</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="153">
                <span class="hits">4</span>
                

                
                <code class="ruby">        monitor.note_error(e, :id =&gt; e.id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="154">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="155">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="156">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def identifying_error_message(identifier)</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="157">
                <span class="hits">5</span>
                

                
                <code class="ruby">        identifier.present? ? &quot; of &#39;#{identifier}&#39;&quot; : &#39;&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="158">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="159">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="160">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_deleted_ids(_ids)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="161">
                
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="162">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="163">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="164">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def deleted_ids(ids, &amp;block)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="165">
                
                

                
                <code class="ruby">        enum = nil</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="166">
                
                

                
                <code class="ruby">        Connectors::Stats.measure(&quot;extractor.#{Connectors::Stats.class_key(self.class)}.deleted_ids&quot;) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="167">
                
                

                
                <code class="ruby">          with_auth_tokens_and_retry do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="168">
                
                

                
                <code class="ruby">            Connectors::Stats.measure(&quot;extractor.#{Connectors::Stats.class_key(self.class)}.yield_deleted_ids&quot;) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="169">
                
                

                
                <code class="ruby">              counter = 0</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="170">
                
                

                
                <code class="ruby">              enum = Enumerator.new do |yielder|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="171">
                
                

                
                <code class="ruby">                yield_deleted_ids(ids) do |id|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="172">
                
                

                
                <code class="ruby">                  yielder.yield id</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="173">
                
                

                
                <code class="ruby">                  counter += 1</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="174">
                
                

                
                <code class="ruby">                  log_info(&quot;Deleted #{counter} documents so far&quot;) if counter % 100 == 0</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="175">
                
                

                
                <code class="ruby">                end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="176">
                
                

                
                <code class="ruby">              end</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="177">
                
                

                
                <code class="ruby">              enum.each(&amp;block) if block_given?</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="178">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="179">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="180">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="181">
                
                

                
                <code class="ruby">        enum</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="182">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="183">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="184">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_permissions(source_user_id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="185">
                
                

                
                <code class="ruby">        # no-op for content source without DLP support</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="186">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="187">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="188">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def permissions(source_user_id, &amp;block)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="189">
                
                

                
                <code class="ruby">        Connectors::Stats.measure(&quot;extractor.#{Connectors::Stats.class_key(self.class)}.permissions&quot;) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="190">
                
                

                
                <code class="ruby">          with_auth_tokens_and_retry do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="191">
                
                

                
                <code class="ruby">            Connectors::Stats.measure(&quot;extractor.#{Connectors::Stats.class_key(self.class)}.yield_permissions&quot;) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="192">
                
                

                
                <code class="ruby">              yield_permissions(source_user_id) do |permissions|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="193">
                
                

                
                <code class="ruby">                log_info(&quot;Extracted #{permissions.size} permissions for source user #{source_user_id}&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="194">
                
                

                
                <code class="ruby">                block.call(permissions) if block_given?</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="195">
                
                

                
                <code class="ruby">              end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="196">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="197">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="198">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="199">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="200">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="201">
                <span class="hits">1</span>
                

                
                <code class="ruby">      ConnectorsShared::Logger::SUPPORTED_LOG_LEVELS.each do |log_level|</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="202">
                <span class="hits">5</span>
                

                
                <code class="ruby">        define_method(:&quot;log_#{log_level}&quot;) do |message|</code>
              </li>
            
              <li class="covered" data-hits="140"
                  data-linenumber="203">
                <span class="hits">140</span>
                

                
                <code class="ruby">          if message.kind_of?(String)</code>
              </li>
            
              <li class="covered" data-hits="140"
                  data-linenumber="204">
                <span class="hits">140</span>
                

                
                <code class="ruby">            message = &quot;ContentSource[#{content_source_id}, #{service_type}]: #{message}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="205">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="covered" data-hits="140"
                  data-linenumber="206">
                <span class="hits">140</span>
                

                
                <code class="ruby">          ConnectorsShared::Logger.public_send(log_level, message)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="207">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="208">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="209">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="210">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def convert_transient_server_errors</code>
              </li>
            
              <li class="covered" data-hits="141"
                  data-linenumber="211">
                <span class="hits">141</span>
                

                
                <code class="ruby">        yield</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="212">
                
                

                
                <code class="ruby">      rescue StandardError =&gt; e</code>
              </li>
            
              <li class="covered" data-hits="17"
                  data-linenumber="213">
                <span class="hits">17</span>
                

                
                <code class="ruby">        raise unless transient_error?(e)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="214">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="215">
                <span class="hits">3</span>
                

                
                <code class="ruby">        raise ConnectorsShared::TransientServerError.new(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="216">
                
                

                
                <code class="ruby">          &quot;Transient error #{e.class}: #{e.message}&quot;,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="217">
                
                

                
                <code class="ruby">          :suspend_until =&gt; AppConfig.connectors.config.fetch(&#39;transient_server_error_retry_delay_minutes&#39;).minutes.from_now,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="218">
                
                

                
                <code class="ruby">          :cursors =&gt; config.cursors</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="219">
                
                

                
                <code class="ruby">        )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="220">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="221">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="222">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def transient_error?(error)</code>
              </li>
            
              <li class="covered" data-hits="90"
                  data-linenumber="223">
                <span class="hits">90</span>
                

                
                <code class="ruby">        TRANSIENT_SERVER_ERROR_CLASSES.any? { |error_class| error.kind_of?(error_class) }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="224">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="225">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="226">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def evictable?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="227">
                
                

                
                <code class="ruby">        false</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="228">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="229">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="230">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def cursors_modified_since_start?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="231">
                
                

                
                <code class="ruby">        config.cursors != original_cursors</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="232">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="233">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="234">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def download_args_and_proc(id, file_name, file_size, &amp;block)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="235">
                
                

                
                <code class="ruby">        [id, file_name, file_size, block]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="236">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="237">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="238">
                <span class="hits">1</span>
                

                
                <code class="ruby">      private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="239">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="240">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def convert_rate_limit_errors</code>
              </li>
            
              <li class="covered" data-hits="139"
                  data-linenumber="241">
                <span class="hits">139</span>
                

                
                <code class="ruby">        yield # subclasses override this with source-specific handling.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="242">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="243">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="244">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def fatal_exception_classes</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="245">
                
                

                
                <code class="ruby">        [</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="246">
                <span class="hits">5</span>
                

                
                <code class="ruby">          ConnectorsShared::TokenRefreshFailedError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="247">
                
                

                
                <code class="ruby">          ConnectorsShared::EvictionError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="248">
                
                

                
                <code class="ruby">          ConnectorsShared::ThrottlingError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="249">
                
                

                
                <code class="ruby">          ConnectorsShared::JobDocumentLimitError,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="250">
                
                

                
                <code class="ruby">          ConnectorsShared::MonitoringError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="251">
                
                

                
                <code class="ruby">        ]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="252">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="253">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="254">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="255">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>132</b> Relevant Lines
          |
          <span class="green"><b>
            100
          </b></span> Lines Covered
          |
          <span class="red"><b>
            32
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="6a5c609b2279112596ede7c490bf505b6cc98c21" id="6a5c609b2279112596ede7c490bf505b6cc98c21">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/office365/adapter.rb
        <span class="parenthese">
          <span class="yellow">
              90.0%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/base/adapter&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="10">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Office365</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Adapter &lt; ConnectorsSdk::Base::Adapter</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.swiftype_document_from_file(_file)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="15">
                
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="16">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="17">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.swiftype_document_from_folder(_folder)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="19">
                <span class="hits">1</span>
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="22">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class GraphItem</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="23">
                <span class="hits">1</span>
                

                
                <code class="ruby">        attr_reader :item</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="25">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def initialize(item)</code>
              </li>
            
              <li class="covered" data-hits="112"
                  data-linenumber="26">
                <span class="hits">112</span>
                

                
                <code class="ruby">          @item = item</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="28">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.convert_id_to_fp_id(_id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="30">
                
                

                
                <code class="ruby">          raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="32">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="33">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.get_path(item)</code>
              </li>
            
              <li class="covered" data-hits="218"
                  data-linenumber="34">
                <span class="hits">218</span>
                

                
                <code class="ruby">          parent_reference_path = item.parentReference&amp;.path || &#39;&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby">          parent_folder_path =</code>
              </li>
            
              <li class="covered" data-hits="218"
                  data-linenumber="36">
                <span class="hits">218</span>
                

                
                <code class="ruby">            if parent_reference_path.end_with?(&#39;root:&#39;)</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="37">
                <span class="hits">2</span>
                

                
                <code class="ruby">              &#39;&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="38">
                
                

                
                <code class="ruby">            else</code>
              </li>
            
              <li class="covered" data-hits="216"
                  data-linenumber="39">
                <span class="hits">216</span>
                

                
                <code class="ruby">              CGI.unescape(parent_reference_path).split(&#39;root:&#39;).last</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="40">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="covered" data-hits="218"
                  data-linenumber="41">
                <span class="hits">218</span>
                

                
                <code class="ruby">          ConnectorsSdk::Office365::Adapter.normalize_path(&quot;#{parent_folder_path}/#{item.name}&quot;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="44">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def to_swiftype_document</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="45">
                
                

                
                <code class="ruby">          {</code>
              </li>
            
              <li class="covered" data-hits="112"
                  data-linenumber="46">
                <span class="hits">112</span>
                

                
                <code class="ruby">            :_fields_to_preserve =&gt; ConnectorsSdk::Office365::Adapter.fields_to_preserve,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="47">
                
                

                
                <code class="ruby">            :id =&gt; self.class.convert_id_to_fp_id(item.id),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="48">
                
                

                
                <code class="ruby">            :path =&gt; get_path(item),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="49">
                
                

                
                <code class="ruby">            :title =&gt; item.name,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="50">
                
                

                
                <code class="ruby">            :url =&gt; item.webUrl,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="51">
                
                

                
                <code class="ruby">            :type =&gt; ConnectorsSdk::Base::Adapter.normalize_enum(type),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="52">
                
                

                
                <code class="ruby">            :created_by =&gt; created_by(item),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="53">
                
                

                
                <code class="ruby">            :created_at =&gt; ConnectorsSdk::Base::Adapter.normalize_date(item.createdDateTime),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="54">
                
                

                
                <code class="ruby">            :last_updated =&gt; ConnectorsSdk::Base::Adapter.normalize_date(item.lastModifiedDateTime),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="55">
                
                

                
                <code class="ruby">            :updated_by =&gt; last_modified_by(item),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="56">
                
                

                
                <code class="ruby">            :drive_owner =&gt; item.drive_owner_name</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="57">
                
                

                
                <code class="ruby">          }.merge(fields).merge(permissions)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="58">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="59">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="60">
                <span class="hits">1</span>
                

                
                <code class="ruby">        private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="61">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="62">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def get_path(item)</code>
              </li>
            
              <li class="covered" data-hits="112"
                  data-linenumber="63">
                <span class="hits">112</span>
                

                
                <code class="ruby">          ConnectorsSdk::Office365::Adapter::GraphItem.get_path(item)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="64">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="65">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="66">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def type</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="67">
                
                

                
                <code class="ruby">          raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="68">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="69">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="70">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def fields</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="71">
                
                

                
                <code class="ruby">          raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="72">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="73">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="74">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def created_by(item)</code>
              </li>
            
              <li class="covered" data-hits="112"
                  data-linenumber="75">
                <span class="hits">112</span>
                

                
                <code class="ruby">          item.createdBy&amp;.user&amp;.displayName</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="76">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="78">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def last_modified_by(item)</code>
              </li>
            
              <li class="covered" data-hits="112"
                  data-linenumber="79">
                <span class="hits">112</span>
                

                
                <code class="ruby">          item.lastModifiedBy&amp;.user&amp;.displayName</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="80">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="81">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="82">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def permissions</code>
              </li>
            
              <li class="covered" data-hits="112"
                  data-linenumber="83">
                <span class="hits">112</span>
                

                
                <code class="ruby">          if item.permissions.present?</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby">            {</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="85">
                <span class="hits">2</span>
                

                
                <code class="ruby">              ConnectorsShared::Constants::ALLOW_FIELD =&gt; item.permissions.map do |next_permission|</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="86">
                
                

                
                <code class="ruby">                [</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="87">
                <span class="hits">4</span>
                

                
                <code class="ruby">                  next_permission.dig(:grantedTo, :user, :id),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="88">
                
                

                
                <code class="ruby">                  next_permission.dig(:grantedTo, :user, :displayName)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="89">
                
                

                
                <code class="ruby">                ].compact</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="90">
                
                

                
                <code class="ruby">              end.flatten.uniq</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="91">
                
                

                
                <code class="ruby">            }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="92">
                
                

                
                <code class="ruby">          else</code>
              </li>
            
              <li class="covered" data-hits="110"
                  data-linenumber="93">
                <span class="hits">110</span>
                

                
                <code class="ruby">            {}</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="94">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="95">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="96">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="97">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="98">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class FileGraphItem &lt; GraphItem</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="99">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.convert_id_to_fp_id(_id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="100">
                
                

                
                <code class="ruby">          raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="101">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="102">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="103">
                <span class="hits">1</span>
                

                
                <code class="ruby">        private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="104">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="105">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def type</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="106">
                <span class="hits">7</span>
                

                
                <code class="ruby">          &#39;file&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="107">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="108">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="109">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def fields</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="110">
                
                

                
                <code class="ruby">          # FIXME: potentially add `updated_by_email`</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="111">
                
                

                
                <code class="ruby">          {</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="112">
                <span class="hits">7</span>
                

                
                <code class="ruby">            :title =&gt; ConnectorsSdk::Base::Adapter.strip_file_extension(item.name),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="113">
                
                

                
                <code class="ruby">            :mime_type =&gt; ConnectorsSdk::Base::Adapter.mime_type_for_file(item.name),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="114">
                
                

                
                <code class="ruby">            :extension =&gt; ConnectorsSdk::Base::Adapter.extension_for_file(item.name)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="115">
                
                

                
                <code class="ruby">          }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="116">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="117">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="118">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="119">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class FolderGraphItem &lt; GraphItem</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="120">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="121">
                <span class="hits">1</span>
                

                
                <code class="ruby">        private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="122">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="123">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def type</code>
              </li>
            
              <li class="covered" data-hits="104"
                  data-linenumber="124">
                <span class="hits">104</span>
                

                
                <code class="ruby">          &#39;folder&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="125">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="126">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="127">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def fields</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="128">
                
                

                
                <code class="ruby">          {</code>
              </li>
            
              <li class="covered" data-hits="208"
                  data-linenumber="129">
                <span class="hits">208</span>
                

                
                <code class="ruby">            :title =&gt; item.root ? item.drive_name : item.name</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="130">
                
                

                
                <code class="ruby">          }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="131">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="132">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="133">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="134">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class PackageGraphItem &lt; GraphItem</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="135">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.convert_id_to_fp_id(id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="136">
                
                

                
                <code class="ruby">          raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="137">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="138">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="139">
                <span class="hits">1</span>
                

                
                <code class="ruby">        private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="140">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="141">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def type</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="142">
                
                

                
                <code class="ruby">          # MSFT gives packages as &#39;oneNote&#39; and it should be called &#39;OneNote&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="143">
                <span class="hits">1</span>
                

                
                <code class="ruby">          item.package.type.classify</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="144">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="145">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="146">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def fields</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="147">
                <span class="hits">1</span>
                

                
                <code class="ruby">          {}</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="148">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="149">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="150">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="151">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="152">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="153">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>60</b> Relevant Lines
          |
          <span class="green"><b>
            54
          </b></span> Lines Covered
          |
          <span class="red"><b>
            6
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="602714a05e4a3edbfc0b9c29b84bd7fdce1adf8f" id="602714a05e4a3edbfc0b9c29b84bd7fdce1adf8f">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/office365/config.rb
        <span class="parenthese">
          <span class="green">
              100.0%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/base/config&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="10">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Office365</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Config &lt; ConnectorsSdk::Base::Config</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">      ALL_DRIVE_IDS = &#39;all&#39;.freeze</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_reader :drive_ids, :index_permissions</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="17">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def initialize(drive_ids:, cursors:, index_permissions: false)</code>
              </li>
            
              <li class="covered" data-hits="17"
                  data-linenumber="19">
                <span class="hits">17</span>
                

                
                <code class="ruby">        super(:cursors =&gt; cursors)</code>
              </li>
            
              <li class="covered" data-hits="17"
                  data-linenumber="20">
                <span class="hits">17</span>
                

                
                <code class="ruby">        @drive_ids = drive_ids</code>
              </li>
            
              <li class="covered" data-hits="17"
                  data-linenumber="21">
                <span class="hits">17</span>
                

                
                <code class="ruby">        @index_permissions = index_permissions</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="23">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="24">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def index_all_drives?</code>
              </li>
            
              <li class="covered" data-hits="10"
                  data-linenumber="25">
                <span class="hits">10</span>
                

                
                <code class="ruby">        drive_ids == ALL_DRIVE_IDS</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="26">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="28">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def to_h</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">        super.merge(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="30">
                
                

                
                <code class="ruby">          :drive_ids =&gt; drive_ids,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">          :index_permissions =&gt; index_permissions</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="32">
                
                

                
                <code class="ruby">        )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="33">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="34">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="36">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>14</b> Relevant Lines
          |
          <span class="green"><b>
            14
          </b></span> Lines Covered
          |
          <span class="red"><b>
            0
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="e2d6f56d4c70b61deade7813a644c654be831169" id="e2d6f56d4c70b61deade7813a644c654be831169">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/office365/custom_client.rb
        <span class="parenthese">
          <span class="red">
              76.22%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/base/custom_client&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_shared&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;hashie/mash&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="12">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Office365</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class CustomClient &lt; ConnectorsSdk::Base::CustomClient</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="16">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">      OFFICE365_PERMISSION_SYNC_TIME_SLA = 24.hours</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="18">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="19">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class ClientError &lt; ConnectorsShared::ClientError</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="20">
                <span class="hits">1</span>
                

                
                <code class="ruby">        attr_reader :status_code, :endpoint</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="22">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def initialize(status_code, endpoint)</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="23">
                <span class="hits">3</span>
                

                
                <code class="ruby">          @status_code = status_code</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="24">
                <span class="hits">3</span>
                

                
                <code class="ruby">          @endpoint = endpoint</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="26">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="28">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class Office365InvalidCursorsError &lt; ClientError; end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="29">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="30">
                
                

                
                <code class="ruby">      # This is necessary because `Faraday::NestedParamsEncoder.encode` changes the</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">      # order of params, which Microsoft&#39;s download API can&#39;t handle for some reason.</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="32">
                <span class="hits">1</span>
                

                
                <code class="ruby">      module Office365DownloadParamsEncoder</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="33">
                <span class="hits">1</span>
                

                
                <code class="ruby">        class &lt;&lt; self</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="34">
                <span class="hits">1</span>
                

                
                <code class="ruby">          extend Forwardable</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="35">
                <span class="hits">1</span>
                

                
                <code class="ruby">          def_delegators :&#39;Faraday::NestedParamsEncoder&#39;, :escape, :decode</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="36">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="37">
                <span class="hits">1</span>
                

                
                <code class="ruby">          def encode(params)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="38">
                
                

                
                <code class="ruby">            params.map do |key, value|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="39">
                
                

                
                <code class="ruby">              &quot;#{escape(key)}=#{escape(value)}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="40">
                
                

                
                <code class="ruby">            end.join(&#39;&amp;&#39;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="41">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="44">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="45">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_reader :access_token</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="46">
                <span class="hits">1</span>
                

                
                <code class="ruby">      attr_accessor :cursors</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="47">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="48">
                <span class="hits">1</span>
                

                
                <code class="ruby">      BASE_URL = &#39;https://graph.microsoft.com/v1.0/&#39;.freeze</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="49">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="50">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def initialize(access_token:, cursors: {}, ensure_fresh_auth: nil)</code>
              </li>
            
              <li class="covered" data-hits="24"
                  data-linenumber="51">
                <span class="hits">24</span>
                

                
                <code class="ruby">        @access_token = access_token</code>
              </li>
            
              <li class="covered" data-hits="24"
                  data-linenumber="52">
                <span class="hits">24</span>
                

                
                <code class="ruby">        @cursors = cursors || {}</code>
              </li>
            
              <li class="covered" data-hits="24"
                  data-linenumber="53">
                <span class="hits">24</span>
                

                
                <code class="ruby">        super(:ensure_fresh_auth =&gt; ensure_fresh_auth)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="54">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="55">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="56">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def update_auth_data!(new_access_token)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="57">
                <span class="hits">1</span>
                

                
                <code class="ruby">        @access_token = new_access_token</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="58">
                <span class="hits">1</span>
                

                
                <code class="ruby">        self</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="59">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="60">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="61">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def me</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="62">
                
                

                
                <code class="ruby">        request_endpoint(:endpoint =&gt; &#39;me&#39;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="63">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="64">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="65">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def one_drive_drives(fields: [])</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="66">
                
                

                
                <code class="ruby">        query_params = transform_fields_to_request_query_params(fields)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="67">
                
                

                
                <code class="ruby">        response = request_endpoint(:endpoint =&gt; &#39;me/drives/&#39;, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="68">
                
                

                
                <code class="ruby">        response.value</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="69">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="70">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="71">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def share_point_drives(fields: [])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="72">
                
                

                
                <code class="ruby">        # When new Private Team site is created in SharePoint, permissions take some time to propagate, therefore</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="73">
                
                

                
                <code class="ruby">        # this site won&#39;t be indexed by us until propagation happens. This code tries to also fetch sites from</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="74">
                
                

                
                <code class="ruby">        # recently created groups (new Private Team site will be there) to reduce friction and index this site</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="75">
                
                

                
                <code class="ruby">        # earlier.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="76">
                
                

                
                <code class="ruby">        # See: https://github.com/elastic/ent-search/pull/3581</code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="77">
                <span class="hits">13</span>
                

                
                <code class="ruby">        share_point_sites = (sites(:fields =&gt; %w[id]) + recent_share_point_group_sites(:fields =&gt; %[id]))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="78">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="79">
                <span class="hits">13</span>
                

                
                <code class="ruby">        share_point_sites</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="80">
                
                

                
                <code class="ruby">          .map(&amp;:id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="81">
                
                

                
                <code class="ruby">          .uniq</code>
              </li>
            
              <li class="covered" data-hits="19"
                  data-linenumber="82">
                <span class="hits">19</span>
                

                
                <code class="ruby">          .map { |site_id| site_drives(site_id, :fields =&gt; fields) }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="83">
                
                

                
                <code class="ruby">          .flatten</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby">          .compact</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="85">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="86">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="87">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def groups(fields: [])</code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="88">
                <span class="hits">13</span>
                

                
                <code class="ruby">        request_all(:endpoint =&gt; &#39;groups/&#39;, :fields =&gt; fields)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="89">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="90">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="91">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def group_root_site(group_id, fields: [])</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="92">
                <span class="hits">3</span>
                

                
                <code class="ruby">        query_params = transform_fields_to_request_query_params(fields)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="93">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="94">
                <span class="hits">3</span>
                

                
                <code class="ruby">        request_endpoint(:endpoint =&gt; &quot;groups/#{group_id}/sites/root&quot;, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="95">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="96">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="97">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def sites(fields: [])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="98">
                
                

                
                <code class="ruby">        # This empty search string ends up returning all sites. If we leave it off, the API returns a 400</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="99">
                
                

                
                <code class="ruby">        # I explicity set the page size here (via :top) because otherwise the API just returns the first ten and</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="100">
                
                

                
                <code class="ruby">        # does not provide any additional pages.</code>
              </li>
            
              <li class="covered" data-hits="14"
                  data-linenumber="101">
                <span class="hits">14</span>
                

                
                <code class="ruby">        request_all(:endpoint =&gt; &#39;sites/&#39;, :fields =&gt; fields, :additional_query_params =&gt; { :search =&gt; &#39;&#39;, :top =&gt; 10 })</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="102">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="103">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="104">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def site_drives(site_id, fields: [])</code>
              </li>
            
              <li class="covered" data-hits="19"
                  data-linenumber="105">
                <span class="hits">19</span>
                

                
                <code class="ruby">        document_libraries(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="106">
                
                

                
                <code class="ruby">          request_all(:endpoint =&gt; &quot;sites/#{site_id}/drives/&quot;, :fields =&gt; fields)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="107">
                
                

                
                <code class="ruby">        )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="108">
                
                

                
                <code class="ruby">      rescue ClientError =&gt; e</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="109">
                
                

                
                <code class="ruby">        ConnectorsShared::Logger.info(&quot;Received response of #{e.status_code} trying to get drive for Site with Id = #{site_id}: #{e.message}&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="110">
                
                

                
                <code class="ruby">        nil</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="111">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="112">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="113">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def list_items(drive_id, fields: [])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="114">
                
                

                
                <code class="ruby">        # MSFT Graph API does not have a recursive list items, have to do this dfs style</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="115">
                <span class="hits">6</span>
                

                
                <code class="ruby">        stack = [get_root_item(drive_id, [&#39;id&#39;]).id]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="116">
                
                

                
                <code class="ruby">        # We rely on the id field below to perform our DFS</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="117">
                <span class="hits">6</span>
                

                
                <code class="ruby">        fields_with_id = fields.any? ? fields | [&#39;id&#39;] : fields</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="118">
                <span class="hits">6</span>
                

                
                <code class="ruby">        while stack.any?</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="119">
                <span class="hits">106</span>
                

                
                <code class="ruby">          folder_id = stack.pop</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="120">
                <span class="hits">106</span>
                

                
                <code class="ruby">          item_children(drive_id, folder_id, :fields =&gt; fields_with_id) do |item|</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="121">
                <span class="hits">106</span>
                

                
                <code class="ruby">            if item.folder</code>
              </li>
            
              <li class="covered" data-hits="101"
                  data-linenumber="122">
                <span class="hits">101</span>
                

                
                <code class="ruby">              stack &lt;&lt; item.id</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="123">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="124">
                <span class="hits">106</span>
                

                
                <code class="ruby">            yield item</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="125">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="126">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="127">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="128">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="129">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="130">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def item_permissions(drive_id, item_id)</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="131">
                <span class="hits">3</span>
                

                
                <code class="ruby">        request_endpoint(:endpoint =&gt; &quot;drives/#{drive_id}/items/#{item_id}/permissions&quot;).value</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="132">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="133">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="134">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def list_changes(drive_id:, start_delta_link: nil, last_modified: nil)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="135">
                
                

                
                <code class="ruby">        query_params = { :&#39;$select&#39; =&gt; %w(id content.downloadUrl lastModifiedDateTime lastModifiedBy root deleted file folder package name webUrl createdBy createdDateTime size).join(&#39;,&#39;) }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="136">
                
                

                
                <code class="ruby">        response =</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="137">
                
                

                
                <code class="ruby">          if start_delta_link.nil?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="138">
                
                

                
                <code class="ruby">            endpoint = &quot;drives/#{drive_id}/root/delta&quot;</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="139">
                
                

                
                <code class="ruby">            request_endpoint(:endpoint =&gt; endpoint, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="140">
                
                

                
                <code class="ruby">          else</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="141">
                
                

                
                <code class="ruby">            request_json(:url =&gt; start_delta_link, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="142">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="143">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="144">
                
                

                
                <code class="ruby">        loop do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="145">
                
                

                
                <code class="ruby">          response.value.each do |change|</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="146">
                
                

                
                <code class="ruby">            # MSFT Graph API does not allow us to view &quot;changes&quot; in chronological order, so if there is no cursor,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="147">
                
                

                
                <code class="ruby">            # we have to iterate through all changes and cherry-pick the ones that are past the `last_modified` Time</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="148">
                
                

                
                <code class="ruby">            # since to get another cursor, we would have to go through all the changes anyway</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="149">
                
                

                
                <code class="ruby">            next if last_modified.present? &amp;&amp; Time.parse(change.lastModifiedDateTime) &lt; last_modified</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="150">
                
                

                
                <code class="ruby">            next if change.root # We don&#39;t want to index the root of the drive</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="151">
                
                

                
                <code class="ruby">            yield change</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="152">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="153">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="154">
                
                

                
                <code class="ruby">          break if response[&#39;@odata.nextLink&#39;].nil?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="155">
                
                

                
                <code class="ruby">          response = request_json(:url =&gt; response[&#39;@odata.nextLink&#39;])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="156">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="157">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="158">
                
                

                
                <code class="ruby">        cursors[drive_id] = response[&#39;@odata.deltaLink&#39;]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="159">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="160">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="161">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def get_latest_delta_link(drive_id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="162">
                
                

                
                <code class="ruby">        cursors[drive_id] || exhaustively_get_delta_link(drive_id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="163">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="164">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="165">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def exhaustively_get_delta_link(drive_id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="166">
                
                

                
                <code class="ruby">        endpoint = &quot;drives/#{drive_id}/root/delta&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="167">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="168">
                
                

                
                <code class="ruby">        Connectors::Stats.measure(&#39;custom_client.office365.exhaustively_get_delta_link&#39;) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="169">
                
                

                
                <code class="ruby">          response = request_endpoint(:endpoint =&gt; endpoint, :query_params =&gt; { :&#39;$select&#39; =&gt; &#39;id&#39; })</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="170">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="171">
                
                

                
                <code class="ruby">          while next_link = response[&#39;@odata.nextLink&#39;]</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="172">
                
                

                
                <code class="ruby">            response = request_json(:url =&gt; next_link)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="173">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="174">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="175">
                
                

                
                <code class="ruby">          response[&#39;@odata.deltaLink&#39;].split(&#39;?&#39;).first</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="176">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="177">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="178">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="179">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def download_item(download_url)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="180">
                
                

                
                <code class="ruby">        request(:url =&gt; download_url) do |request|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="181">
                
                

                
                <code class="ruby">          request.options.params_encoder = Office365DownloadParamsEncoder</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="182">
                
                

                
                <code class="ruby">        end.body</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="183">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="184">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="185">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def user_groups(user_id, fields = [])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="186">
                
                

                
                <code class="ruby">        (</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="187">
                <span class="hits">6</span>
                

                
                <code class="ruby">          request_all(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="188">
                
                

                
                <code class="ruby">            :endpoint =&gt; &quot;users/#{user_id}/transitiveMemberOf&quot;,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="189">
                
                

                
                <code class="ruby">            :fields =&gt; fields</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="190">
                
                

                
                <code class="ruby">          ) +</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="191">
                
                

                
                <code class="ruby">            request_all(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="192">
                
                

                
                <code class="ruby">              :endpoint =&gt; &quot;users/#{user_id}/ownedObjects&quot;,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="193">
                
                

                
                <code class="ruby">              :fields =&gt; fields</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="194">
                <span class="hits">3</span>
                

                
                <code class="ruby">            ).select { |next_object| next_object[&#39;@odata.type&#39;] == &#39;#microsoft.graph.group&#39; }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="195">
                
                

                
                <code class="ruby">        ).uniq</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="196">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="197">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="198">
                <span class="hits">1</span>
                

                
                <code class="ruby">      private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="199">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="200">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def recent_share_point_group_sites(fields: [])</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="201">
                
                

                
                <code class="ruby">        # group.createdDateTime field is UTC as stated in documentation:</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="202">
                
                

                
                <code class="ruby">        # https://docs.microsoft.com/en-us/graph/api/resources/group?view=graph-rest-1.0#properties</code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="203">
                <span class="hits">13</span>
                

                
                <code class="ruby">        created_date_time_threshold = Time.now.utc - OFFICE365_PERMISSION_SYNC_TIME_SLA</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="204">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="13"
                  data-linenumber="205">
                <span class="hits">13</span>
                

                
                <code class="ruby">        groups(:fields =&gt; %w(id createdDateTime))</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="206">
                <span class="hits">6</span>
                

                
                <code class="ruby">          .select { |group| group.createdDateTime &gt; created_date_time_threshold }</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="207">
                <span class="hits">3</span>
                

                
                <code class="ruby">          .map { |group| group_root_site(group.id, :fields =&gt; %w[id]) }.compact</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="208">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="209">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="210">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def document_libraries(drives)</code>
              </li>
            
              <li class="covered" data-hits="38"
                  data-linenumber="211">
                <span class="hits">38</span>
                

                
                <code class="ruby">        drives.select { |drive| drive.driveType == &#39;documentLibrary&#39; }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="212">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="213">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="214">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def transform_fields_to_request_query_params(fields = [])</code>
              </li>
            
              <li class="covered" data-hits="171"
                  data-linenumber="215">
                <span class="hits">171</span>
                

                
                <code class="ruby">        fields.empty? ? {} : { :&#39;$select&#39; =&gt; fields.join(&#39;,&#39;) }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="216">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="217">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="218">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def request_all(endpoint:, fields: [], additional_query_params: {})</code>
              </li>
            
              <li class="covered" data-hits="56"
                  data-linenumber="219">
                <span class="hits">56</span>
                

                
                <code class="ruby">        query_params = transform_fields_to_request_query_params(fields)</code>
              </li>
            
              <li class="covered" data-hits="56"
                  data-linenumber="220">
                <span class="hits">56</span>
                

                
                <code class="ruby">        response = request_endpoint(:endpoint =&gt; endpoint, :query_params =&gt; query_params.merge(additional_query_params))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="221">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="54"
                  data-linenumber="222">
                <span class="hits">54</span>
                

                
                <code class="ruby">        items = response.value</code>
              </li>
            
              <li class="covered" data-hits="54"
                  data-linenumber="223">
                <span class="hits">54</span>
                

                
                <code class="ruby">        while next_link = response[&#39;@odata.nextLink&#39;]</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="224">
                <span class="hits">1</span>
                

                
                <code class="ruby">          response = request_json(:url =&gt; next_link)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="225">
                <span class="hits">1</span>
                

                
                <code class="ruby">          items.concat(response.value)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="226">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="covered" data-hits="54"
                  data-linenumber="227">
                <span class="hits">54</span>
                

                
                <code class="ruby">        items</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="228">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="229">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="230">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def get_root_item(drive_id, fields = [])</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="231">
                <span class="hits">6</span>
                

                
                <code class="ruby">        query_params = transform_fields_to_request_query_params(fields)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="232">
                <span class="hits">6</span>
                

                
                <code class="ruby">        request_endpoint(:endpoint =&gt; &quot;drives/#{drive_id}/root&quot;, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="233">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="234">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="235">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def item_children(drive_id, item_id, fields: [], &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="236">
                <span class="hits">106</span>
                

                
                <code class="ruby">        endpoint = &quot;drives/#{drive_id}/items/#{item_id}/children&quot;</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="237">
                <span class="hits">106</span>
                

                
                <code class="ruby">        query_params = transform_fields_to_request_query_params(fields)</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="238">
                <span class="hits">106</span>
                

                
                <code class="ruby">        response = request_endpoint(:endpoint =&gt; endpoint, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="239">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="240">
                <span class="hits">106</span>
                

                
                <code class="ruby">        loop do</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="241">
                <span class="hits">106</span>
                

                
                <code class="ruby">          response.value.each(&amp;block)</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="242">
                <span class="hits">105</span>
                

                
                <code class="ruby">          next_link = response[&#39;@odata.nextLink&#39;]</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="243">
                <span class="hits">105</span>
                

                
                <code class="ruby">          break if next_link.nil?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="244">
                
                

                
                <code class="ruby">          response = request_json(:url =&gt; next_link)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="245">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="246">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="247">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="248">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def base_headers</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="249">
                
                

                
                <code class="ruby">        {</code>
              </li>
            
              <li class="covered" data-hits="179"
                  data-linenumber="250">
                <span class="hits">179</span>
                

                
                <code class="ruby">          &#39;Authorization&#39; =&gt; &quot;Bearer #{access_token}&quot;,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="251">
                
                

                
                <code class="ruby">          &#39;Content-Type&#39; =&gt; &#39;application/json&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="252">
                
                

                
                <code class="ruby">        }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="253">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="254">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="255">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def raise_any_errors(response, url:, query_params: {})</code>
              </li>
            
              <li class="covered" data-hits="179"
                  data-linenumber="256">
                <span class="hits">179</span>
                

                
                <code class="ruby">        if HTTP::Status.successful?(response.status)</code>
              </li>
            
              <li class="covered" data-hits="176"
                  data-linenumber="257">
                <span class="hits">176</span>
                

                
                <code class="ruby">          response</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="258">
                
                

                
                <code class="ruby">        else</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="259">
                <span class="hits">3</span>
                

                
                <code class="ruby">          response_body = response.body.to_s</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="260">
                
                

                
                <code class="ruby">          error_message = begin</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="261">
                <span class="hits">3</span>
                

                
                <code class="ruby">            error = JSON.parse(response_body).fetch(&#39;error&#39;)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="262">
                <span class="hits">1</span>
                

                
                <code class="ruby">            if error[&#39;code&#39;] == &#39;resyncRequired&#39;</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="263">
                
                

                
                <code class="ruby">              Connectors::Stats.increment(&#39;custom_client.office365.error.invalid_cursors&#39;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="264">
                
                

                
                <code class="ruby">              raise Office365InvalidCursorsError.new(response.status, url)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="265">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="266">
                <span class="hits">1</span>
                

                
                <code class="ruby">            JSON.parse(error.fetch(&#39;message&#39;)).fetch(&#39;Message&#39;).strip</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="267">
                
                

                
                <code class="ruby">          rescue ClientError</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="268">
                
                

                
                <code class="ruby">            raise</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="269">
                
                

                
                <code class="ruby">          rescue StandardError</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="270">
                <span class="hits">2</span>
                

                
                <code class="ruby">            &quot;got a #{response.status} from #{url} with query #{query_params}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="271">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="272">
                <span class="hits">3</span>
                

                
                <code class="ruby">          raise ClientError.new(response.status, url), error_message</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="273">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="274">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="275">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="276">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def request_endpoint(endpoint:, query_params: nil)</code>
              </li>
            
              <li class="covered" data-hits="178"
                  data-linenumber="277">
                <span class="hits">178</span>
                

                
                <code class="ruby">        url = &quot;#{BASE_URL}#{endpoint}&quot;</code>
              </li>
            
              <li class="covered" data-hits="178"
                  data-linenumber="278">
                <span class="hits">178</span>
                

                
                <code class="ruby">        request_json(:url =&gt; url, :query_params =&gt; query_params)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="279">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="280">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="281">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def request_json(url:, query_params: nil)</code>
              </li>
            
              <li class="covered" data-hits="179"
                  data-linenumber="282">
                <span class="hits">179</span>
                

                
                <code class="ruby">        response = request(:url =&gt; url, :query_params =&gt; query_params, :headers =&gt; base_headers)</code>
              </li>
            
              <li class="covered" data-hits="176"
                  data-linenumber="283">
                <span class="hits">176</span>
                

                
                <code class="ruby">        Hashie::Mash.new(JSON.parse(response.body))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="284">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="285">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="286">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def request(url:, query_params: nil, headers: nil, &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="179"
                  data-linenumber="287">
                <span class="hits">179</span>
                

                
                <code class="ruby">        raise_any_errors(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="288">
                
                

                
                <code class="ruby">          get(url, query_params, headers, &amp;block),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="289">
                
                

                
                <code class="ruby">          :url =&gt; url,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="290">
                
                

                
                <code class="ruby">          :query_params =&gt; query_params</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="291">
                
                

                
                <code class="ruby">        )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="292">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="293">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="294">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="295">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>143</b> Relevant Lines
          |
          <span class="green"><b>
            109
          </b></span> Lines Covered
          |
          <span class="red"><b>
            34
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="14deee6b806867eac2fe5b26484adc98bc72f301" id="14deee6b806867eac2fe5b26484adc98bc72f301">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/office365/extractor.rb
        <span class="parenthese">
          <span class="red">
              63.46%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/office365/custom_client&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/base/extractor&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="11">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Office365</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Extractor &lt; ConnectorsSdk::Base::Extractor</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">      DRIVE_IDS_CURSOR_KEY = &#39;drive_ids&#39;.freeze</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="16">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_document_changes(modified_since: nil, &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="8"
                  data-linenumber="18">
                <span class="hits">8</span>
                

                
                <code class="ruby">        drives_to_index.each do |drive|</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="19">
                <span class="hits">6</span>
                

                
                <code class="ruby">          drive_id = drive.id</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="20">
                <span class="hits">6</span>
                

                
                <code class="ruby">          drive_owner_name = drive.dig(:owner, :user, :displayName)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="21">
                <span class="hits">6</span>
                

                
                <code class="ruby">          drive_name = drive.name</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="23">
                <span class="hits">6</span>
                

                
                <code class="ruby">          drive_id_to_delta_link = config.cursors.fetch(DRIVE_IDS_CURSOR_KEY, {})</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby">          begin</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="25">
                <span class="hits">6</span>
                

                
                <code class="ruby">            if start_delta_link = drive_id_to_delta_link[drive_id]</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="26">
                
                

                
                <code class="ruby">              log_debug(&quot;Starting an incremental crawl with cursor for #{service_type.classify} with drive_id: #{drive_id}&quot;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby">              begin</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="28">
                
                

                
                <code class="ruby">                yield_changes(drive_id, :start_delta_link =&gt; start_delta_link, :drive_owner_name =&gt; drive_owner_name, :drive_name =&gt; drive_name, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="29">
                
                

                
                <code class="ruby">              rescue ConnectorsSdk::Office365::CustomClient::Office365InvalidCursorsError</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="30">
                
                

                
                <code class="ruby">                log_warn(&quot;Error listing changes with start_delta_link: #{start_delta_link}, falling back to full crawl&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="31">
                
                

                
                <code class="ruby">                yield_drive_items(drive_id, :drive_owner_name =&gt; drive_owner_name, :drive_name =&gt; drive_name, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="32">
                
                

                
                <code class="ruby">              end</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="33">
                <span class="hits">6</span>
                

                
                <code class="ruby">            elsif !modified_since.nil?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="34">
                
                

                
                <code class="ruby">              log_debug(&quot;Starting an incremental crawl using last_modified (no cursor found) for #{service_type.classify} with drive_id: #{drive_id}&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="35">
                
                

                
                <code class="ruby">              yield_changes(drive_id, :last_modified =&gt; modified_since, :drive_owner_name =&gt; drive_owner_name, :drive_name =&gt; drive_name, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="36">
                
                

                
                <code class="ruby">            else</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="37">
                <span class="hits">6</span>
                

                
                <code class="ruby">              log_debug(&quot;Starting a full crawl #{service_type.classify} with drive_id: #{drive_id}&quot;)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="38">
                <span class="hits">6</span>
                

                
                <code class="ruby">              yield_drive_items(drive_id, :drive_owner_name =&gt; drive_owner_name, :drive_name =&gt; drive_name, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="39">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="40">
                
                

                
                <code class="ruby">          rescue ConnectorsSdk::Office365::CustomClient::ClientError =&gt; e</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="41">
                
                

                
                <code class="ruby">            log_warn(&quot;Error searching and listing drive #{drive_id}&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="42">
                
                

                
                <code class="ruby">            capture_exception(e)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="44">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="45">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="46">
                
                

                
                <code class="ruby">        nil</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="47">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="48">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="49">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_deleted_ids(ids)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="50">
                
                

                
                <code class="ruby">        ids.each do |id|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="51">
                
                

                
                <code class="ruby">          yield id unless existing_drive_item_ids.include?(id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="52">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="53">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="54">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="55">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def retrieve_latest_cursors</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="56">
                
                

                
                <code class="ruby">        delta_links_for_drive_ids = drives_to_index.map(&amp;:id).each_with_object({}) do |drive_id, h|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="57">
                
                

                
                <code class="ruby">          h[drive_id] = client.get_latest_delta_link(drive_id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="58">
                
                

                
                <code class="ruby">        rescue ConnectorsSdk::Office365::CustomClient::ClientError =&gt; e</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="59">
                
                

                
                <code class="ruby">          log_warn(&quot;Error getting delta link for #{drive_id}&quot;)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="60">
                
                

                
                <code class="ruby">          capture_exception(e)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="61">
                
                

                
                <code class="ruby">          raise e</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="62">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="63">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="64">
                
                

                
                <code class="ruby">        {</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="65">
                
                

                
                <code class="ruby">          DRIVE_IDS_CURSOR_KEY =&gt; delta_links_for_drive_ids</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="66">
                
                

                
                <code class="ruby">        }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="67">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="68">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="69">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_permissions(source_user_id)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="70">
                <span class="hits">6</span>
                

                
                <code class="ruby">        permissions = [source_user_id]</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="71">
                <span class="hits">6</span>
                

                
                <code class="ruby">        client.user_groups(source_user_id, %w(id displayName)).each do |next_group|</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="72">
                
                

                
                <code class="ruby">          # Adding &quot;Members&quot; suffix since that is how the item permissions endpoint return group permissions</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="73">
                <span class="hits">4</span>
                

                
                <code class="ruby">          permissions &lt;&lt; &quot;#{next_group.displayName} Members&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="74">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="75">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="76">
                <span class="hits">4</span>
                

                
                <code class="ruby">        yield permissions.uniq</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby">      rescue ConnectorsSdk::Office365::CustomClient::ClientError =&gt; e</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="78">
                
                

                
                <code class="ruby">        # if a user is deleted, client.user_groups will throw 404 Not Found error, saving another call to get user profile</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="79">
                <span class="hits">2</span>
                

                
                <code class="ruby">        if e.status_code == 404</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="80">
                <span class="hits">1</span>
                

                
                <code class="ruby">          log_warn(&quot;Could not find a user with id #{source_user_id}&quot;)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="81">
                <span class="hits">1</span>
                

                
                <code class="ruby">          yield []</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="82">
                
                

                
                <code class="ruby">        else</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="83">
                <span class="hits">1</span>
                

                
                <code class="ruby">          raise</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="85">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="86">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="87">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def client</code>
              </li>
            
              <li class="covered" data-hits="25"
                  data-linenumber="88">
                <span class="hits">25</span>
                

                
                <code class="ruby">        @client ||= super.tap do |client|</code>
              </li>
            
              <li class="covered" data-hits="16"
                  data-linenumber="89">
                <span class="hits">16</span>
                

                
                <code class="ruby">          client.cursors = config.cursors&amp;.fetch(DRIVE_IDS_CURSOR_KEY, {}) || {}</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="90">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="91">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="92">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="93">
                <span class="hits">1</span>
                

                
                <code class="ruby">      private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="94">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="95">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def drives</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="96">
                
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="97">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="98">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="99">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def drives_to_index</code>
              </li>
            
              <li class="covered" data-hits="10"
                  data-linenumber="100">
                <span class="hits">10</span>
                

                
                <code class="ruby">        @drives_to_index ||=</code>
              </li>
            
              <li class="covered" data-hits="10"
                  data-linenumber="101">
                <span class="hits">10</span>
                

                
                <code class="ruby">          if config.index_all_drives?</code>
              </li>
            
              <li class="covered" data-hits="9"
                  data-linenumber="102">
                <span class="hits">9</span>
                

                
                <code class="ruby">            drives</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="103">
                
                

                
                <code class="ruby">          else</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="104">
                <span class="hits">3</span>
                

                
                <code class="ruby">            drives.select { |d| config.drive_ids.include?(d.id) }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="105">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="106">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="107">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="108">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def existing_drive_item_ids</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="109">
                
                

                
                <code class="ruby">        @existing_drive_item_ids ||= Set.new.tap do |ids|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="110">
                
                

                
                <code class="ruby">          drives_to_index.each do |drive|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="111">
                
                

                
                <code class="ruby">            client.list_items(drive.id) do |item|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="112">
                
                

                
                <code class="ruby">              ids &lt;&lt; convert_id_to_fp_id(item.id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="113">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="114">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="115">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="116">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="117">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="118">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def adapter</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="119">
                
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="120">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="121">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="122">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def convert_id_to_fp_id(_id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="123">
                
                

                
                <code class="ruby">        raise NotImplementedError</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="124">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="125">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="126">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def capture_exception(office365_client_error)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="127">
                
                

                
                <code class="ruby">        options = {</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="128">
                
                

                
                <code class="ruby">          :extra =&gt; {</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="129">
                
                

                
                <code class="ruby">            :status_code =&gt; office365_client_error.status_code,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="130">
                
                

                
                <code class="ruby">            :endpoint =&gt; office365_client_error.endpoint</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="131">
                
                

                
                <code class="ruby">          }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="132">
                
                

                
                <code class="ruby">        }</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="133">
                
                

                
                <code class="ruby">        ConnectorsShared::ExceptionTracking.capture_exception(office365_client_error, options)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="134">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="135">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="136">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_drive_items(drive_id, drive_owner_name:, drive_name:, &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="6"
                  data-linenumber="137">
                <span class="hits">6</span>
                

                
                <code class="ruby">        client.list_items(drive_id) do |item|</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="138">
                <span class="hits">106</span>
                

                
                <code class="ruby">          yield_single_document_change(:identifier =&gt; &quot;Office365 change: #{item&amp;.id} (#{Office365::Adapter::GraphItem.get_path(item)})&quot;) do</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="139">
                <span class="hits">106</span>
                

                
                <code class="ruby">            item.drive_owner_name = drive_owner_name</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="140">
                <span class="hits">106</span>
                

                
                <code class="ruby">            item.drive_name = drive_name</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="141">
                <span class="hits">106</span>
                

                
                <code class="ruby">            yield_create_or_update(drive_id, item, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="142">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="143">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="144">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="145">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="146">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_correct_actions_and_converted_item(drive_id, item, &amp;block)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="147">
                
                

                
                <code class="ruby">        if item.deleted.nil?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="148">
                
                

                
                <code class="ruby">          yield_create_or_update(drive_id, item, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="149">
                
                

                
                <code class="ruby">        else</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="150">
                
                

                
                <code class="ruby">          yield :delete, convert_id_to_fp_id(item.id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="151">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="152">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="153">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="154">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_changes(drive_id, drive_owner_name:, drive_name:, start_delta_link: nil, last_modified: nil, &amp;block)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="155">
                
                

                
                <code class="ruby">        client.list_changes(:drive_id =&gt; drive_id, :start_delta_link =&gt; start_delta_link, :last_modified =&gt; last_modified) do |item|</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="156">
                
                

                
                <code class="ruby">          yield_single_document_change(:identifier =&gt; &quot;Office365 change: #{item&amp;.id} (#{Office365::Adapter::GraphItem.get_path(item)})&quot;) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="157">
                
                

                
                <code class="ruby">            item.drive_owner_name = drive_owner_name</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="158">
                
                

                
                <code class="ruby">            item.drive_name = drive_name</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="159">
                
                

                
                <code class="ruby">            yield_correct_actions_and_converted_item(drive_id, item, &amp;block)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="160">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="161">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="162">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="163">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="164">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def yield_create_or_update(drive_id, item)</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="165">
                <span class="hits">106</span>
                

                
                <code class="ruby">        item = with_permissions(drive_id, item)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="166">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="167">
                <span class="hits">106</span>
                

                
                <code class="ruby">        document = generate_document(item)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="168">
                
                

                
                <code class="ruby">        download_args =</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="169">
                <span class="hits">105</span>
                

                
                <code class="ruby">          if downloadable?(item)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="170">
                
                

                
                <code class="ruby">            download_args_and_proc(document.fetch(:id), item.name, item[:size]) do</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="171">
                
                

                
                <code class="ruby">              client.download_item(item.fetch(&#39;@microsoft.graph.downloadUrl&#39;))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="172">
                
                

                
                <code class="ruby">            end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="173">
                
                

                
                <code class="ruby">          else</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="174">
                <span class="hits">105</span>
                

                
                <code class="ruby">            []</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="175">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="176">
                <span class="hits">105</span>
                

                
                <code class="ruby">        yield :create_or_update, document, download_args</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="177">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="178">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="179">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def downloadable?(item)</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="180">
                <span class="hits">105</span>
                

                
                <code class="ruby">        item.key?(&#39;@microsoft.graph.downloadUrl&#39;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="181">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="182">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="183">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def generate_document(item)</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="184">
                <span class="hits">105</span>
                

                
                <code class="ruby">        if item.file</code>
              </li>
            
              <li class="covered" data-hits="4"
                  data-linenumber="185">
                <span class="hits">4</span>
                

                
                <code class="ruby">          adapter.swiftype_document_from_file(item)</code>
              </li>
            
              <li class="covered" data-hits="101"
                  data-linenumber="186">
                <span class="hits">101</span>
                

                
                <code class="ruby">        elsif item.folder</code>
              </li>
            
              <li class="covered" data-hits="101"
                  data-linenumber="187">
                <span class="hits">101</span>
                

                
                <code class="ruby">          adapter.swiftype_document_from_folder(item)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="188">
                
                

                
                <code class="ruby">        elsif item.package</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="189">
                
                

                
                <code class="ruby">          adapter.swiftype_document_from_package(item)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="190">
                
                

                
                <code class="ruby">        else</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="191">
                
                

                
                <code class="ruby">          raise &quot;Unexpected Office 365 item type for item #{item}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="192">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="193">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="194">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="195">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def with_permissions(drive_id, item)</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="196">
                <span class="hits">106</span>
                

                
                <code class="ruby">        item = item.dup</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="197">
                <span class="hits">106</span>
                

                
                <code class="ruby">        item.permissions = client.item_permissions(drive_id, item.id) if config.index_permissions</code>
              </li>
            
              <li class="covered" data-hits="106"
                  data-linenumber="198">
                <span class="hits">106</span>
                

                
                <code class="ruby">        item</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="199">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="200">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="201">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="202">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>104</b> Relevant Lines
          |
          <span class="green"><b>
            66
          </b></span> Lines Covered
          |
          <span class="red"><b>
            38
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="032f628bf402538bf91bb00770626cf5e0be81cf" id="032f628bf402538bf91bb00770626cf5e0be81cf">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/share_point/adapter.rb
        <span class="parenthese">
          <span class="green">
              100.0%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/office365/adapter&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="10">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module SharePoint</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Adapter &lt; Office365::Adapter</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">      generate_id_helpers :share_point, &#39;share_point&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.swiftype_document_from_file(file)</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="17">
                <span class="hits">7</span>
                

                
                <code class="ruby">        FileGraphItem.new(file).to_swiftype_document</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="18">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="19">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="20">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.swiftype_document_from_folder(folder)</code>
              </li>
            
              <li class="covered" data-hits="104"
                  data-linenumber="21">
                <span class="hits">104</span>
                

                
                <code class="ruby">        FolderGraphItem.new(folder).to_swiftype_document</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="22">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="23">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="24">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def self.swiftype_document_from_package(package)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="25">
                <span class="hits">1</span>
                

                
                <code class="ruby">        PackageGraphItem.new(package).to_swiftype_document</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="26">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="28">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class FileGraphItem &lt; Office365::Adapter::FileGraphItem</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.convert_id_to_fp_id(id)</code>
              </li>
            
              <li class="covered" data-hits="7"
                  data-linenumber="30">
                <span class="hits">7</span>
                

                
                <code class="ruby">          ConnectorsSdk::SharePoint::Adapter.share_point_id_to_fp_id(id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="32">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="33">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="34">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class FolderGraphItem &lt; Office365::Adapter::FolderGraphItem</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="35">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.convert_id_to_fp_id(id)</code>
              </li>
            
              <li class="covered" data-hits="104"
                  data-linenumber="36">
                <span class="hits">104</span>
                

                
                <code class="ruby">          ConnectorsSdk::SharePoint::Adapter.share_point_id_to_fp_id(id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="37">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="38">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="39">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="40">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class PackageGraphItem &lt; Office365::Adapter::PackageGraphItem</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="41">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def self.convert_id_to_fp_id(id)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="42">
                <span class="hits">1</span>
                

                
                <code class="ruby">          ConnectorsSdk::SharePoint::Adapter.share_point_id_to_fp_id(id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="44">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="45">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="46">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="47">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>20</b> Relevant Lines
          |
          <span class="green"><b>
            20
          </b></span> Lines Covered
          |
          <span class="red"><b>
            0
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="4a5323b4cba55ac7c5738d0bbf272404524c5b4e" id="4a5323b4cba55ac7c5738d0bbf272404524c5b4e">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/share_point/authorization.rb
        <span class="parenthese">
          <span class="green">
              97.62%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_shared&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;signet&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;signet/oauth_2&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;signet/oauth_2/client&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="13">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module SharePoint</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Authorization</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">      class &lt;&lt; self</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def authorization_url</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="19">
                <span class="hits">5</span>
                

                
                <code class="ruby">          &#39;https://login.microsoftonline.com/common/oauth2/v2.0/authorize&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="22">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def token_credential_uri</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="23">
                <span class="hits">5</span>
                

                
                <code class="ruby">          &#39;https://login.microsoftonline.com/common/oauth2/v2.0/token&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="26">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def authorization_uri(params)</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="27">
                <span class="hits">3</span>
                

                
                <code class="ruby">          missing = missing_fields(params, %w[client_id])</code>
              </li>
            
              <li class="covered" data-hits="3"
                  data-linenumber="28">
                <span class="hits">3</span>
                

                
                <code class="ruby">          unless missing.blank?</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">            raise ConnectorsShared::ClientError.new(&quot;Missing required fields: #{missing.join(&#39;, &#39;)}&quot;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="30">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="32">
                <span class="hits">2</span>
                

                
                <code class="ruby">          params[:response_type] = &#39;code&#39;</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="33">
                <span class="hits">2</span>
                

                
                <code class="ruby">          params[:additional_parameters] = { :prompt =&gt; &#39;consent&#39; }</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="34">
                <span class="hits">2</span>
                

                
                <code class="ruby">          client = oauth_client(params)</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="35">
                <span class="hits">2</span>
                

                
                <code class="ruby">          client.authorization_uri.to_s</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="36">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="37">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="38">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def access_token(params)</code>
              </li>
            
              <li class="covered" data-hits="10"
                  data-linenumber="39">
                <span class="hits">10</span>
                

                
                <code class="ruby">          missing = missing_fields(params, %w[client_id client_secret code redirect_uri])</code>
              </li>
            
              <li class="covered" data-hits="10"
                  data-linenumber="40">
                <span class="hits">10</span>
                

                
                <code class="ruby">          unless missing.blank?</code>
              </li>
            
              <li class="covered" data-hits="8"
                  data-linenumber="41">
                <span class="hits">8</span>
                

                
                <code class="ruby">            raise ConnectorsShared::ClientError.new(&quot;Missing required fields: #{missing.join(&#39;, &#39;)}&quot;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="44">
                <span class="hits">2</span>
                

                
                <code class="ruby">          params[:grant_type] = &#39;authorization_code&#39;</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="45">
                <span class="hits">2</span>
                

                
                <code class="ruby">          client = oauth_client(params)</code>
              </li>
            
              <li class="covered" data-hits="2"
                  data-linenumber="46">
                <span class="hits">2</span>
                

                
                <code class="ruby">          client.fetch_access_token.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="47">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="48">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="49">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def refresh(params)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="50">
                <span class="hits">1</span>
                

                
                <code class="ruby">          missing = missing_fields(params, %w[client_id client_secret refresh_token redirect_uri])</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="51">
                <span class="hits">1</span>
                

                
                <code class="ruby">          unless missing.blank?</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="52">
                
                

                
                <code class="ruby">            raise ConnectorsShared::ClientError.new(&quot;Missing required fields: #{missing.join(&#39;, &#39;)}&quot;)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="53">
                
                

                
                <code class="ruby">          end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="54">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="55">
                <span class="hits">1</span>
                

                
                <code class="ruby">          params[:grant_type] = &#39;refresh_token&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="56">
                <span class="hits">1</span>
                

                
                <code class="ruby">          client = oauth_client(params)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="57">
                <span class="hits">1</span>
                

                
                <code class="ruby">          client.refresh!.to_json</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="58">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="59">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="60">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def oauth_client(params)</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="61">
                <span class="hits">5</span>
                

                
                <code class="ruby">          options = params.merge(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="62">
                
                

                
                <code class="ruby">            :authorization_uri =&gt; authorization_url,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="63">
                
                

                
                <code class="ruby">            :token_credential_uri =&gt; token_credential_uri,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="64">
                
                

                
                <code class="ruby">            :scope =&gt; oauth_scope</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="65">
                
                

                
                <code class="ruby">          )</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="66">
                <span class="hits">5</span>
                

                
                <code class="ruby">          options[:state] = JSON.dump(options[:state]) if options[:state]</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="67">
                <span class="hits">5</span>
                

                
                <code class="ruby">          Signet::OAuth2::Client.new(options)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="68">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="69">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="70">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def oauth_scope</code>
              </li>
            
              <li class="covered" data-hits="5"
                  data-linenumber="71">
                <span class="hits">5</span>
                

                
                <code class="ruby">          %w[</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="72">
                
                

                
                <code class="ruby">            User.ReadBasic.All</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="73">
                
                

                
                <code class="ruby">            Group.Read.All</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="74">
                
                

                
                <code class="ruby">            Directory.AccessAsUser.All</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="75">
                
                

                
                <code class="ruby">            Files.Read</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="76">
                
                

                
                <code class="ruby">            Files.Read.All</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="77">
                
                

                
                <code class="ruby">            Sites.Read.All</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="78">
                
                

                
                <code class="ruby">            offline_access</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="79">
                
                

                
                <code class="ruby">          ]</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="80">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="81">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="82">
                <span class="hits">1</span>
                

                
                <code class="ruby">        def missing_fields(params, required = [])</code>
              </li>
            
              <li class="covered" data-hits="61"
                  data-linenumber="83">
                <span class="hits">61</span>
                

                
                <code class="ruby">          Array.wrap(required).select { |field| params[field.to_sym].nil? }</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="84">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="85">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="86">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="87">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="88">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>42</b> Relevant Lines
          |
          <span class="green"><b>
            41
          </b></span> Lines Covered
          |
          <span class="red"><b>
            1
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="7d3baf96475a38ac46fcd9c1fcea2a7845f272a3" id="7d3baf96475a38ac46fcd9c1fcea2a7845f272a3">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/share_point/extractor.rb
        <span class="parenthese">
          <span class="green">
              91.67%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/office365/extractor&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/share_point/adapter&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="11">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module SharePoint</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class Extractor &lt; ConnectorsSdk::Office365::Extractor</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">      private</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="17">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def convert_id_to_fp_id(id)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="19">
                
                

                
                <code class="ruby">        ConnectorsSdk::SharePoint::Adapter.share_point_id_to_fp_id(id)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="21">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="22">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def adapter</code>
              </li>
            
              <li class="covered" data-hits="105"
                  data-linenumber="23">
                <span class="hits">105</span>
                

                
                <code class="ruby">        ConnectorsSdk::SharePoint::Adapter</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="26">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def drives</code>
              </li>
            
              <li class="covered" data-hits="10"
                  data-linenumber="27">
                <span class="hits">10</span>
                

                
                <code class="ruby">        client.share_point_drives(:fields =&gt; %w(id owner name driveType))</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="28">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="29">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="30">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>12</b> Relevant Lines
          |
          <span class="green"><b>
            11
          </b></span> Lines Covered
          |
          <span class="red"><b>
            1
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="b63d277b678ad5b1be38257d45e16b134de13876" id="b63d277b678ad5b1be38257d45e16b134de13876">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/connectors_sdk/share_point/http_call_wrapper.rb
        <span class="parenthese">
          <span class="green">
              94.44%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/office365/config&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="10">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;connectors_sdk/share_point/extractor&#39;</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;bson&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="12">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">module ConnectorsSdk</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="14">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module SharePoint</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="15">
                <span class="hits">1</span>
                

                
                <code class="ruby">    class HttpCallWrapper</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="16">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def initialize(params)</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">        features = {}</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="18">
                <span class="hits">1</span>
                

                
                <code class="ruby">        @extractor = ConnectorsSdk::SharePoint::Extractor.new(</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="19">
                
                

                
                <code class="ruby">          content_source_id: BSON::ObjectId.new,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby">          service_type: &#39;sharepoint_online&#39;,</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="21">
                
                

                
                <code class="ruby">          authorization_data_proc: proc { { access_token: params[&#39;access_token&#39;] } },</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="22">
                <span class="hits">1</span>
                

                
                <code class="ruby">          client_proc: proc { ConnectorsSdk::Office365::CustomClient.new(:access_token =&gt; params[&#39;access_token&#39;], :cursors =&gt; {}) },</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="23">
                
                

                
                <code class="ruby">          config: ConnectorsSdk::Office365::Config.new(:cursors =&gt; {}, :drive_ids =&gt; &#39;all&#39;),</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby">          features: features</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="25">
                
                

                
                <code class="ruby">        )</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="26">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="28">
                <span class="hits">1</span>
                

                
                <code class="ruby">      def document_batch</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="29">
                <span class="hits">1</span>
                

                
                <code class="ruby">        results = []</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="30">
                <span class="hits">1</span>
                

                
                <code class="ruby">        max = 100</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="32">
                <span class="hits">1</span>
                

                
                <code class="ruby">        @extractor.yield_document_changes do |action, doc, _subextractors|</code>
              </li>
            
              <li class="covered" data-hits="101"
                  data-linenumber="33">
                <span class="hits">101</span>
                

                
                <code class="ruby">          results &lt;&lt; {</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="34">
                
                

                
                <code class="ruby">            :action =&gt; action,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby">            :document =&gt; doc,</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="36">
                
                

                
                <code class="ruby">            :download =&gt; nil</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="37">
                
                

                
                <code class="ruby">          }</code>
              </li>
            
              <li class="covered" data-hits="101"
                  data-linenumber="38">
                <span class="hits">101</span>
                

                
                <code class="ruby">          break if results.size &gt; max</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="39">
                
                

                
                <code class="ruby">        end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="40">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="41">
                <span class="hits">1</span>
                

                
                <code class="ruby">        results</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="42">
                
                

                
                <code class="ruby">      end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="43">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="44">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="45">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>18</b> Relevant Lines
          |
          <span class="green"><b>
            17
          </b></span> Lines Covered
          |
          <span class="red"><b>
            1
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
        <div class="mdc-dialog" role="alertdialog" aria-modal="true"
     aria-labelledby="1d143f969815d51a0025e2390a4f48fd413f511e" id="1d143f969815d51a0025e2390a4f48fd413f511e">
  <div class="mdc-dialog__container">
    <div class="mdc-dialog__surface">
      <h2 class="mdc-dialog__title">
        lib/stubs/connectors/stats.rb
        <span class="parenthese">
          <span class="green">
              92.31%
          </span>
        </span>
        
      </h2>

      <div class="mdc-dialog__content">
        <pre>
          <ol>
            
              <li class="never" data-hits=""
                  data-linenumber="1">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="2">
                
                

                
                <code class="ruby"># Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="3">
                
                

                
                <code class="ruby"># or more contributor license agreements. Licensed under the Elastic License;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="4">
                
                

                
                <code class="ruby"># you may not use this file except in compliance with the Elastic License.</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="5">
                
                

                
                <code class="ruby">#</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="6">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="7">
                
                

                
                <code class="ruby"># frozen_string_literal: true</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="8">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="9">
                <span class="hits">1</span>
                

                
                <code class="ruby">require &#39;active_support/inflector&#39;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="10">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="11">
                <span class="hits">1</span>
                

                
                <code class="ruby">module Connectors</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="12">
                <span class="hits">1</span>
                

                
                <code class="ruby">  module Stats</code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="13">
                <span class="hits">1</span>
                

                
                <code class="ruby">    def self.measure(_key, _value = nil, &amp;block)</code>
              </li>
            
              <li class="covered" data-hits="30"
                  data-linenumber="14">
                <span class="hits">30</span>
                

                
                <code class="ruby">      block.call</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="15">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="16">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="17">
                <span class="hits">1</span>
                

                
                <code class="ruby">    def self.increment(key, value = 1)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="18">
                
                

                
                <code class="ruby">      # no op</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="19">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="20">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="21">
                <span class="hits">1</span>
                

                
                <code class="ruby">    def self.prefix_key(key)</code>
              </li>
            
              <li class="missed" data-hits="0"
                  data-linenumber="22">
                
                

                
                <code class="ruby">      &quot;connectors.#{key}&quot;</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="23">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="24">
                
                

                
                <code class="ruby"></code>
              </li>
            
              <li class="covered" data-hits="1"
                  data-linenumber="25">
                <span class="hits">1</span>
                

                
                <code class="ruby">    def self.class_key(klass, deconstantize = true)</code>
              </li>
            
              <li class="covered" data-hits="30"
                  data-linenumber="26">
                <span class="hits">30</span>
                

                
                <code class="ruby">      name = klass.name</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="27">
                
                

                
                <code class="ruby">      # Changes Connectors::GoogleDrive::Adapter to Connectors::GoogleDrive</code>
              </li>
            
              <li class="covered" data-hits="30"
                  data-linenumber="28">
                <span class="hits">30</span>
                

                
                <code class="ruby">      name = ActiveSupport::Inflector.deconstantize(name) if deconstantize</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="29">
                
                

                
                <code class="ruby">      # Changes Connectors::GoogleDrive to GoogleDrive</code>
              </li>
            
              <li class="covered" data-hits="30"
                  data-linenumber="30">
                <span class="hits">30</span>
                

                
                <code class="ruby">      name = ActiveSupport::Inflector.demodulize(name)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="31">
                
                

                
                <code class="ruby">      # Changes GoogleDrive to google_drive</code>
              </li>
            
              <li class="covered" data-hits="30"
                  data-linenumber="32">
                <span class="hits">30</span>
                

                
                <code class="ruby">      ActiveSupport::Inflector.underscore(name)</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="33">
                
                

                
                <code class="ruby">    end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="34">
                
                

                
                <code class="ruby">  end</code>
              </li>
            
              <li class="never" data-hits=""
                  data-linenumber="35">
                
                

                
                <code class="ruby">end</code>
              </li>
            
          </ol>
        </pre>
      </div>

      <footer class="mdc-dialog__actions">
        <div class="text">
          <b>13</b> Relevant Lines
          |
          <span class="green"><b>
            12
          </b></span> Lines Covered
          |
          <span class="red"><b>
            1
          </b></span> Lines Missed
          
        </div>
        <div class="buttons">
          <button type="button" class="mdc-button mdc-button--raised mdc-dialog__button" data-mdc-dialog-action="close">
            <span class="mdc-button__label">close</span>
          </button>
        </div>
      </footer>
    </div>
  </div>
  <div class="mdc-dialog__scrim"></div>
</div>

    
    <script src="./dist/1.0.0/application.js" type="text/javascript"></script>
  </body>
</html>
